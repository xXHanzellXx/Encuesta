<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>SoftSkills360 - Inicia sesiÃ³n</title>
</head>
Â  <style>/* ğŸŒŒ ESTILO GLOBAL - SoftSkills360 LOGIN/REGISTER */
:root {
Â  --color-primary: #10b981; /* Esmeralda */
Â  --color-accent: #3b82f6;Â  /* Azul ElÃ©ctrico */
Â  --color-bg-dark: #0f172a; /* Fondo oscuro */
Â  --color-card-dark: #1e293b; /* Tarjeta */
Â  --color-text-light: #f1f5f9;
}

body {
Â  font-family: 'Inter', sans-serif;
Â  /* Gradiente de fondo con efectos visuales */
Â  background: radial-gradient(at 0% 0%, #1e3a8a 0%, transparent 60%),
Â  Â  Â  Â  Â  Â  Â  radial-gradient(at 100% 100%, #10b981 0%, transparent 60%),
Â  Â  Â  Â  Â  Â  Â  var(--color-bg-dark);
Â  color: var(--color-text-light);
Â  margin: 0;
Â  min-height: 100vh;
Â  display: flex;
Â  justify-content: center;
Â  align-items: center;
Â  overflow: hidden;
Â  position: relative;
}

/* ğŸŒŸ EFECTO DE FONDO ANIMADO */
body::before {
Â  content: '';
Â  position: fixed;
Â  inset: 0;
Â  background: radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.08) 0%, transparent 70%),
Â  Â  Â  Â  Â  Â  Â  radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 70%);
Â  z-index: -1;
Â  animation: pulseGlow 6s ease-in-out infinite alternate;
}
@keyframes pulseGlow {
Â  from { opacity: 0.5; }
Â  to { opacity: 1; }
}

/* ğŸ§© CONTENEDOR PRINCIPAL */
.container {
Â  background: rgba(30, 41, 59, 0.85);
Â  border: 1px solid rgba(148, 163, 184, 0.2);
Â  border-radius: 1.5rem;
Â  padding: 3rem 2.5rem;
Â  width: 90%;
Â  max-width: 420px;
Â  text-align: center;
Â  box-shadow: 0 0 25px rgba(16, 185, 129, 0.25), inset 0 0 10px rgba(59, 130, 246, 0.1);
Â  transform: scale(0.96);
Â  transition: all 0.4s ease;
Â  animation: popCard 0.6s ease forwards;
}
.container:hover {
Â  transform: scale(1.01);
Â  box-shadow: 0 0 35px rgba(16, 185, 129, 0.4), 0 0 25px rgba(59, 130, 246, 0.3);
}

/* ğŸ’« ANIMACIÃ“N DE APARICIÃ“N */
@keyframes popCard {
Â  from {
Â  Â  opacity: 0;
Â  Â  transform: scale(0.8) translateY(10px);
Â  }
Â  to {
Â  Â  opacity: 1;
Â  Â  transform: scale(1);
Â  }
}

/* ğŸ”¹ TÃTULOS */
.container h1 {
Â  font-size: 2.2rem;
Â  font-weight: 900;
Â  text-transform: uppercase;
Â  color: white;
Â  text-shadow: 0 0 8px var(--color-accent);
Â  margin-bottom: 2rem;
}

.container h2 {
Â  font-size: 1.6rem;
Â  font-weight: 800;
Â  color: var(--color-primary);
Â  text-shadow: 0 0 6px rgba(16, 185, 129, 0.6);
Â  margin-bottom: 1.5rem;
}

/* âœï¸ INPUTS */
input {
Â  width: 100%;
Â  padding: 0.9rem 1rem;
Â  margin: 0.6rem 0;
Â  border: 2px solid rgba(100, 116, 139, 0.4);
Â  border-radius: 0.75rem;
Â  background: rgba(15, 23, 42, 0.8);
Â  color: #e2e8f0;
Â  font-size: 1rem;
Â  outline: none;
Â  transition: all 0.3s ease;
Â  box-shadow: inset 0 0 5px rgba(59, 130, 246, 0.2);
}
input:focus {
Â  border-color: var(--color-primary);
Â  box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);
Â  transform: scale(1.02);
}

/* ğŸš€ BOTONES */
button {
Â  width: 100%;
Â  background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
Â  color: #0f172a;
Â  font-weight: 900;
Â  border: none;
Â  border-radius: 0.75rem;
Â  padding: 0.9rem 2rem;
Â  margin-top: 1rem;
Â  cursor: pointer;
Â  transition: all 0.3s ease;
Â  box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
}
button:hover {
Â  transform: scale(1.05);
Â  box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);
}

/* ğŸ”— LINKS ENTRE FORMULARIOS */
p {
Â  margin-top: 1.2rem;
Â  font-size: 0.95rem;
Â  color: #cbd5e1;
}
a {
Â  color: var(--color-accent);
Â  cursor: pointer;
Â  font-weight: 600;
Â  transition: color 0.3s ease, text-shadow 0.3s ease;
}
a:hover {
Â  color: var(--color-primary);
Â  text-shadow: 0 0 6px var(--color-primary);
}

/* ğŸ’¡ MENSAJE DE FEEDBACK */
#messageBox {
    margin-top: 1.5rem;
    padding: 1rem;
    border-radius: 0.75rem;
    font-size: 0.9rem;
    font-weight: 700;
    text-align: center;
    border: 1px solid transparent;
    transition: all 0.3s ease;
}
.msg-error {
    background: rgba(239, 68, 68, 0.2); /* Red 500/20 */
    color: #fca5a5; /* Red 300 */
    border-color: rgba(239, 68, 68, 0.4);
}
.msg-success {
    background: rgba(16, 185, 129, 0.2); /* Emerald 500/20 */
    color: #a7f3d0; /* Emerald 300 */
    border-color: rgba(16, 185, 129, 0.4);
}

/* ğŸ’¡ RESPONSIVIDAD */
@media (max-width: 600px) {
Â  .container {
Â  Â  padding: 2.2rem 1.5rem;
Â  }
Â  .container h1 {
Â  Â  font-size: 1.8rem;
Â  }
Â  input, button {
Â  Â  font-size: 0.95rem;
Â  }
}
</style>
<body>
Â  <div class="container">
Â  Â  <h1>SoftSkills360</h1>

Â  Â  <div id="loginForm">
Â  Â  Â  <h2>Iniciar sesiÃ³n</h2>
Â  Â  Â  <input id="loginEmail" placeholder="Email" type="email">
Â  Â  Â  <input id="loginPassword" placeholder="ContraseÃ±a" type="password">
Â  Â  Â  <button id="loginBtn" type="button">Entrar</button>
Â  Â  Â  <p>Â¿No tienes cuenta? <a id="toRegister">RegÃ­strate aquÃ­</a></p>
Â  Â  </div>

Â  Â  <div id="registerForm" style="display:none;">
Â  Â  Â  <h2>Registro</h2>
Â  Â  Â  <input id="regName" placeholder="Nombre">
Â  Â  Â  <input id="regEmail" placeholder="Email" type="email">
Â  Â  Â  <input id="regPassword" placeholder="ContraseÃ±a" type="password">
Â  Â  Â  <button id="registerBtn" type="button">Registrarme</button>
Â  Â  Â  <p>Â¿Ya tienes cuenta? <a id="toLogin">Inicia sesiÃ³n</a></p>
Â  Â  </div>
    
    <!-- Contenedor para mensajes de feedback/sugerencia -->
    <div id="messageBox" class="hidden"></div>
Â  </div>

Â  <script>
    // URL de la API de Render
    const API_URL = "https://encuestaa.onrender.com";

    // Referencias a los elementos del DOM
    const loginFormDiv = document.getElementById('loginForm');
    const registerFormDiv = document.getElementById('registerForm');
    const toRegisterLink = document.getElementById('toRegister');
    const toLoginLink = document.getElementById('toLogin');
    const loginEmailInput = document.getElementById('loginEmail');
    const loginPasswordInput = document.getElementById('loginPassword');
    const regNameInput = document.getElementById('regName');
    const regEmailInput = document.getElementById('regEmail');
    const regPasswordInput = document.getElementById('regPassword');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const messageBox = document.getElementById('messageBox');

    // ------------------------------------------
    // 1. FUNCIONES DE VALIDACIÃ“N
    // ------------------------------------------

    /**
     * Valida si el email tiene un formato bÃ¡sico y parece real.
     */
    function validateEmail(email) {
        // Regex estricta: debe tener formato usuario@dominio.tld
        const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,63}$/;
        return regex.test(email);
    }

    /**
     * EvalÃºa la seguridad de la contraseÃ±a y retorna un objeto de resultado.
     */
    function getPasswordStrength(password) {
        if (password.length < 8) {
            return { valid: false, message: "La contraseÃ±a debe tener al menos 8 caracteres." };
        }
        if (!/[A-Z]/.test(password)) {
            return { valid: false, message: "Debe incluir al menos una letra mayÃºscula (A-Z)." };
        }
        if (!/[a-z]/.test(password)) {
            return { valid: false, message: "Debe incluir al menos una letra minÃºscula (a-z)." };
        }
        if (!/\d/.test(password)) {
            return { valid: false, message: "Debe incluir al menos un nÃºmero (0-9)." };
        }
        if (!/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/.test(password)) {
            return { valid: false, message: "Debe incluir al menos un sÃ­mbolo (ej: !, @, #)." };
        }

        return { valid: true, message: "ContraseÃ±a segura." };
    }


    // ------------------------------------------
    // 2. FUNCIÃ“N DE MENSAJES
    // ------------------------------------------

    /**
     * Muestra el mensaje de feedback con el estilo apropiado.
     */
    function displayMessage(message, type = 'error') {
        messageBox.textContent = message;
        messageBox.classList.remove('hidden', 'msg-error', 'msg-success');
        
        if (type === 'success') {
            messageBox.classList.add('msg-success');
        } else { // 'error' o sugerencia
            messageBox.classList.add('msg-error');
        }
    }


    // ------------------------------------------
    // 3. MANEJADOR DE ENVÃO Y API CALL
    // ------------------------------------------

    /**
     * Maneja la lÃ³gica de validaciÃ³n y envÃ­o real a la API.
     * @param {boolean} isRegister - True si es el formulario de registro, False para login.
     */
    async function handleSubmission(isRegister) {
        let email, password, name;
        let isValid = true;
        let errorMessage = '';

        // Ocultar mensaje anterior
        messageBox.classList.add('hidden');

        if (isRegister) {
            // RecolecciÃ³n de datos y validaciÃ³n de Nombre
            name = regNameInput.value.trim();
            email = regEmailInput.value.trim();
            password = regPasswordInput.value;
            
            if (!name) {
                isValid = false;
                errorMessage = "Por favor, introduce tu nombre.";
            }

        } else {
            // RecolecciÃ³n de datos para Login
            email = loginEmailInput.value.trim();
            password = loginPasswordInput.value;

            // En Login, solo comprobamos que no estÃ© vacÃ­o
            if (password.length === 0) {
                isValid = false;
                errorMessage = "Por favor, introduce tu contraseÃ±a.";
            }
        }

        if (!isValid) {
            displayMessage(errorMessage);
            return;
        }

        // ValidaciÃ³n de Email
        if (!validateEmail(email)) {
            displayMessage("El formato del correo electrÃ³nico no es vÃ¡lido. Debe ser similar a 'usuario@dominio.com'.");
            return;
        }
        
        // ValidaciÃ³n de ContraseÃ±a (seguridad estricta solo en REGISTRO)
        if (isRegister) {
            const passwordResult = getPasswordStrength(password);
            if (!passwordResult.valid) {
                // Mostrar sugerencia de seguridad
                displayMessage(`ContraseÃ±a dÃ©bil. Sugerencia: ${passwordResult.message}`);
                return;
            }
        }
        
        // --- API CALL ---
        const endpoint = isRegister ? "/api/register" : "/api/login";
        const payload = isRegister 
            ? { name, email, password }
            : { email, password };

        try {
            // Mostrar mensaje de carga/procesamiento
            displayMessage(`Procesando ${isRegister ? 'registro' : 'inicio de sesiÃ³n'}...`, 'success'); 
            
            const res = await fetch(`${API_URL}${endpoint}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            });

            const data = await res.json();

            if (res.ok) {
                if (isRegister) {
                    displayMessage("âœ… Registro exitoso. Â¡Ahora puedes iniciar sesiÃ³n!", 'success');
                    
                    // Cambiar a la vista de login automÃ¡ticamente
                    // Se usa toLoginLink.click() para ejecutar el listener existente
                    toLoginLink.click();
                    
                    // Limpiar campos de registro
                    regNameInput.value = '';
                    regEmailInput.value = '';
                    regPasswordInput.value = '';

                } else {
                    // Login exitoso
                    if (data.token) {
                        localStorage.setItem("token", data.token);
                        localStorage.setItem("userName", data.name || email);
                    }
                    
                    const userName = data.name || email;
                    displayMessage(`ğŸ‰ Inicio de sesiÃ³n exitoso. Â¡Bienvenido, ${userName}! Redirigiendo...`, 'success');
                    
                    // Limpiar campos de login
                    loginEmailInput.value = '';
                    loginPasswordInput.value = '';
                    
                    // Redirige al usuario a la pÃ¡gina principal despuÃ©s de un breve retraso
                    setTimeout(() => {
                        // AquÃ­ deberÃ­as redirigir a tu pÃ¡gina principal (ej: home.html)
                        window.location.href = "home.html";
                    }, 1500); 
                }

            } else {
                // Error de la API (ej: 400, 401, 409)
                const errorMsg = data.detail || `Error desconocido: ${res.status} ${res.statusText}`;
                displayMessage(`âŒ Error: ${errorMsg}`);
            }

        } catch (error) {
            console.error("Fetch error:", error);
            displayMessage("ğŸš¨ Error de conexiÃ³n con la API. Verifica la URL o tu conexiÃ³n de red.");
        }
    }


    // ------------------------------------------
    // 4. LISTENERS (Botones, Enter y Switch)
    // ------------------------------------------

    // Manejo de clicks en botones
    loginBtn.addEventListener('click', () => handleSubmission(false));
    registerBtn.addEventListener('click', () => handleSubmission(true));

    
    // Manejo de la tecla ENTER para Login
    const loginInputs = [loginEmailInput, loginPasswordInput];
    loginInputs.forEach(input => {
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Evita el submit por defecto
                handleSubmission(false);
            }
        });
    });

    // Manejo de la tecla ENTER para Registro
    const registerInputs = [regNameInput, regEmailInput, regPasswordInput];
    registerInputs.forEach(input => {
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Evita el submit por defecto
                handleSubmission(true);
            }
        });
    });


    // LÃ³gica para cambiar entre formularios (Mantener la funcionalidad original)
    toRegisterLink.addEventListener('click', (e) => {
        e.preventDefault();
        loginFormDiv.style.display = 'none';
        registerFormDiv.style.display = 'block';
        messageBox.classList.add('hidden'); // Limpiar mensajes al cambiar
    });

    toLoginLink.addEventListener('click', (e) => {
        e.preventDefault();
        registerFormDiv.style.display = 'none';
        loginFormDiv.style.display = 'block';
        messageBox.classList.add('hidden'); // Limpiar mensajes al cambiar
    });

Â  </script>
</body>
</html>
