<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SoftSkills360 - Test de Habilidades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
    /* ğŸ¨ CONFIGURACIÃ“N GLOBAL - ESTILO OSCURO ESMERALDA */
:root {
  --color-primary: #10b981; /* Esmeralda 500 */
  --color-accent: #059669; /* Esmeralda 600 */
  --color-bg-dark: #0f172a; /* Fondo oscuro */
  --color-card-dark: #1e293b; /* Fondo de tarjetas */
  --color-text-light: #f8fafc; /* Texto claro */
  --color-border: #475569; /* Borde neutro */
}

.quiz-container {
  perspective: 1200px; /* ğŸ”¹ MÃ¡s profundidad */
}

.quiz-card {
  transform-style: preserve-3d;
  transition: transform 0.3s ease;
  will-change: transform;
}

body {
  font-family: "Inter", sans-serif;
  background-color: var(--color-bg-dark);
  min-height: 100vh;
  color: var(--color-text-light);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow-y: auto;
  margin: 0;
}

/* ğŸ”¹ NAVBAR */
.navbar {
  background-color: rgba(15, 23, 42, 0.9);
  backdrop-filter: blur(6px);
  border-bottom: 2px solid var(--color-primary);
  padding: 0.6rem 1.2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 20;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
}

.navbar h1 {
  font-size: 1.3rem;
  font-weight: 900;
  color: var(--color-text-light);
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
}

/* ğŸ§© CONTENEDOR DEL QUIZ */
.quiz-container {
  max-width: 700px;
  margin: 5rem auto 2rem auto;
  padding: 1rem;
  position: relative;
  perspective: 1000px;
  transform: scale(0.95);
}

/* ğŸ’« TARJETA DEL QUIZ */
.quiz-card,
.result-card {
  background-color: var(--color-card-dark);
  border: 1px solid var(--color-border);
  border-radius: 1rem;
  padding: 1.8rem;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
  transition: all 0.5s ease, box-shadow 0.3s ease;
  animation: popCard 0.6s ease forwards;
}

.quiz-card:hover {
  transform: scale(1.01);
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
}

@keyframes popCard {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* ğŸ”¸ BARRA DE PROGRESO */
.progress-bar {
  width: 100%;
  height: 8px;
  background: #334155; /* gris azulado */
  border-radius: 9999px;
  margin-bottom: 1rem;
}

.progress-fill {
  background: var(--color-primary);
  height: 8px;
  width: 0%;
  border-radius: 9999px;
  box-shadow: 0 0 10px var(--color-primary);
  transition: width 0.6s ease-in-out;
}

/* â“ PREGUNTA */
.question-item {
  text-align: center;
}

.question-item p {
  font-size: 1.6rem;
  font-weight: 800;
  color: var(--color-text-light);
  margin-bottom: 1.2rem;
  text-shadow: 0 0 6px rgba(16, 185, 129, 0.4);
}

/* âš¡ OPCIONES */
.options-group {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.8rem;
  margin-top: 1rem;
}

.option-btn {
  background-color: #334155;
  border: 1px solid var(--color-border);
  color: var(--color-text-light);
  padding: 0.6rem 1.4rem;
  font-size: 1rem;
  font-weight: 700;
  border-radius: 0.6rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 120px;
  max-width: 220px;
  text-align: center;
}

.option-btn:hover {
  background-color: #475569;
  transform: scale(1.05);
  box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
}

.option-btn.selected {
  background: var(--color-primary);
  color: #0f172a;
  border: 2px solid white;
  font-weight: 900;
  transform: scale(1.08);
  box-shadow: 0 0 10px var(--color-primary);
}

/* ğŸ”» BOTONES DE ACCIÃ“N */
.quiz-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.cta-btn {
  background-color: var(--color-primary);
  color: #0f172a;
  font-weight: 900;
  padding: 0.7rem 1.6rem;
  border-radius: 0.6rem;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
  font-size: 0.95rem;
}

.cta-btn:hover {
  background-color: var(--color-accent);
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
}

.secondary-btn {
  background-color: #334155;
  color: var(--color-text-light);
  font-weight: 700;
  padding: 0.7rem 1.6rem;
  border-radius: 0.6rem;
  transition: all 0.3s ease;
  font-size: 0.95rem;
}

.secondary-btn:hover {
  background-color: #475569;
  transform: scale(1.03);
}

/* ğŸ’¬ RESULTADOS */
.result-card {
  text-align: center;
  padding: 1.8rem;
  margin-bottom: 2rem;
}

.result-card .text-emerald-500 {
  font-size: 1.8rem;
  font-weight: 900;
  color: var(--color-primary);
  text-shadow: 0 0 8px rgba(16, 185, 129, 0.7);
}

.result-card p {
  font-size: 1rem;
  color: #d1d5db;
}

.skill-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.4rem 0;
}

.skill-name {
  font-weight: 600;
  color: var(--color-text-light);
  width: 30%;
  text-align: left;
}

.skill-bar-container {
  flex-grow: 1;
  height: 8px;
  background-color: #334155;
  border-radius: 9999px;
  overflow: hidden;
}

.skill-bar {
  height: 100%;
  background-color: var(--color-primary);
  transition: width 0.5s ease-out;
  box-shadow: 0 0 4px rgba(16, 185, 129, 0.6);
}

/* Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 50;
  opacity: 0; /* Controlado por JS */
  visibility: hidden; /* Controlado por JS */
  transition: opacity 0.3s ease;
}

.modal-overlay.open {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background-color: var(--color-card-dark);
  padding: 1.5rem;
  border-radius: 1rem;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  max-width: 380px;
  text-align: center;
  border: 2px solid var(--color-primary);
}

.modal-content h3 {
  font-size: 1.3rem;
  font-weight: 800;
  color: var(--color-primary);
  margin-bottom: 0.8rem;
}

/* ğŸŒŸ EFECTO DE FONDO */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(
    circle at 50% 50%,
    rgba(16, 185, 129, 0.06) 0%,
    transparent 70%
  );
  z-index: -1;
}

/* ğŸ“± RESPONSIVIDAD */
@media (max-width: 640px) {
  .question-item p {
    font-size: 1.3rem;
  }

  .option-btn {
    width: 100%;
  }

  .quiz-card,
  .result-card {
    padding: 1.5rem;
  }

  .cta-btn,
  .secondary-btn {
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
  }
}
    </style>
  </head>
<body>
Â  Â  <header class="navbar">
Â  Â  Â  <h1>Habilidades Blandas</h1>
Â  Â  Â  <button id="backBtn" class="secondary-btn p-2 px-4">Volver</button>
Â  Â  </header>

Â  Â  <main class="quiz-container">
Â  Â  Â  <div id="quiz" class="quiz-card">
Â  Â  Â  Â  <h2 class="text-4xl font-extrabold text-center mb-8 text-white">
Â  Â  Â  Â  Â  INICIANDO ANÃLISIS DE HABILIDADES
Â  Â  Â  Â  </h2>

Â  Â  Â  Â  <div class="progress-bar">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  id="progressBarFill"
Â  Â  Â  Â  Â  Â  class="progress-fill"
Â  Â  Â  Â  Â  Â  style="width: 0%"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  id="questionsContainer"
Â  Â  Â  Â  Â  class="min-h-[250px] flex items-center justify-center"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div id="loading" class="text-gray-400 text-lg">
Â  Â  Â  Â  Â  Â  Cargando preguntas...
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="quiz-actions">
Â  Â  Â  Â  Â  <button id="prevBtn" class="secondary-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Anterior
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="nextBtn" class="cta-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Siguiente
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="submitBtn" class="cta-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Finalizar Test
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="progress-footer text-center mt-4">
Â  Â  Â  Â  <p
Â  Â  Â  Â  Â  id="progressText"
Â  Â  Â  Â  Â  class="text-lg font-mono text-emerald-400 tracking-wider"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Cargando...
Â  Â  Â  Â  </p>
Â  Â  Â  </div>

Â  Â  Â  <div id="result" class="result-card" style="display: none">
Â  Â  Â  Â  <h3 class="text-4xl font-extrabold text-center mb-6 text-emerald-500">
Â  Â  Â  Â  ğŸš€ :: RESULTADOS FINALES :: ğŸš€
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div id="resultContent" class="text-gray-300">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="bg-gray-900/50 p-6 rounded-xl mb-8 border border-emerald-600/50"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <p class="text-lg font-medium mb-2 text-gray-400">
Â  Â  Â  Â  Â  Â  Â  PERFIL DETERMINADO:
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <h4
Â  Â  Â  Â  Â  Â  Â  id="profileName"
Â  Â  Â  Â  Â  Â  Â  class="text-3xl font-extrabold text-emerald-400"
Â  Â  Â  Â  Â  Â  ></h4>
Â  Â  Â  Â  Â  Â  <p id="profileDescription" class="mt-3 text-gray-400 italic"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="topSkillsPills" class="mt-4 flex flex-wrap gap-2"></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <h4
Â  Â  Â  Â  Â  Â  class="text-2xl font-bold mt-8 mb-4 border-b pb-2 border-slate-700/50 text-white"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  MÃ‰TRICAS DE HABILIDAD (0-100)
Â  Â  Â  Â  Â  </h4>
Â  Â  Â  Â  Â  <div id="skillsList" class="space-y-3">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="mt-10 text-center">
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="saveResultBtn"
Â  Â  Â  Â  Â  Â  class="cta-btn disabled:opacity-50"
Â  Â  Â  Â  Â  Â  disabled
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Guardar Resultado
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="goHomeFromQuiz" class="secondary-btn ml-4">
Â  Â  Â  Â  Â  Â  Volver al Inicio
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button 
Â  Â  Â  Â  Â  Â  id="restartQuizBtn" 
Â  Â  Â  Â  Â  Â  class="secondary-btn ml-4 bg-yellow-600 hover:bg-yellow-700 text-white"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Repetir Test
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="alertModal" class="modal-overlay">
Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h3 id="alertTitle">Â¡ALERTA DE SISTEMA!</h3>
Â  Â  Â  Â  <p id="alertMessage" class="text-gray-300">Mensaje de prueba.</p>
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  class="cta-btn bg-red-600 hover:bg-red-700 mt-6 text-white"
Â  Â  Â  Â  Â  onclick="closeAlertModal()"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ACECEPTAR
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>

    <script>
     // --- URL DE LA API ---
const API_URL = "https://encuestaa.onrender.com"; 

// --- CONSTANTES Y CONFIGURACIÃ“N ---
const MAX_SCORE_PER_QUESTION_RAW = 5;
const COOLDOWN_DAYS = 7;
const LAST_QUIZ_KEY = 'lastQuizCompletion';
const PREVIOUS_RESULT_KEY = 'previousQuizResult';

// Escalas de respuesta
const ANSWER_SCALES = {
    'attitude': {
        options: ["Totalmente en desacuerdo", "En desacuerdo", "Neutral/Depende", "De acuerdo", "Totalmente de acuerdo"]
    },
    'frequency': {
        options: ["Casi nunca lo hago", "Raramente lo hago", "A veces lo hago", "Lo hago frecuentemente", "Casi siempre lo hago"]
    }
};
const DEFAULT_SCALE = 'frequency';

// --- DATA COMPLETA (40 PREGUNTAS MULTIFACTORIALES) ---
const QUIZ_DATA = [
    { id: 1, text: "Al inicio de un proyecto, Â¿dedicas mÃ¡s tiempo a la planificaciÃ³n detallada (milestones, dependencias) que a la ejecuciÃ³n inmediata?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 2, text: "Si un requisito clave de un cliente cambia a Ãºltima hora, Â¿te frustras o lo ves como una oportunidad para demostrar flexibilidad?", scores: [{ skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'attitude' },
    { id: 3, text: "En una reuniÃ³n de ideas, Â¿sientes que es tu deber seÃ±alar los defectos de una idea 'loca' en lugar de intentar mejorarla?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: -1 }], scaleType: 'attitude' },
    { id: 4, text: "Â¿Buscas tomar todas las decisiones importantes del equipo para asegurar que se hagan 'bien', restando autonomÃ­a a tus compaÃ±eros?", scores: [{ skill: "Liderazgo", polarity: -1 }, { skill: "Trabajo en equipo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'frequency' },
    { id: 5, text: "Cuando un colega te pide ayuda o te explica un problema, Â¿le interrumpes para ofrecerle la soluciÃ³n apenas crees entender la causa?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }], scaleType: 'frequency' },
    { id: 6, text: "Â¿Realizas o exploras una nueva herramienta o curso por iniciativa propia, incluso si no tiene una aplicaciÃ³n directa en tu trabajo actual?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Creatividad e innovaciÃ³n", polarity: 1 }], scaleType: 'frequency' },
    { id: 7, text: "Si fallas un plazo importante, Â¿te cuesta dÃ­as recuperarte emocionalmente y volver a concentrarte en otras tareas?", scores: [{ skill: "Resiliencia", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }], scaleType: 'attitude' },
    { id: 8, text: "En un debate intenso, Â¿priorizas alcanzar un acuerdo que satisfaga a todos sobre imponer tu punto de vista lÃ³gicamente superior?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }], scaleType: 'attitude' },
    { id: 9, text: "Â¿Te sientes muy incÃ³modo cuando un software o proceso que dominas es reemplazado por uno nuevo sin previo aviso?", scores: [{ skill: "Adaptabilidad al cambio", polarity: -1 }, { skill: "Aprendizaje continuo", polarity: -1 }, { skill: "Resiliencia", polarity: -1 }], scaleType: 'attitude' },
    { id: 10, text: "Â¿Eres de los que prefiere 'pedir perdÃ³n antes que permiso' cuando ves una oportunidad clara de mejora o eficiencia?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'attitude' },
    { id: 11, text: "Â¿Ante un problema conocido, primero revisas si existe un proceso o soluciÃ³n estÃ¡ndar, antes de intentar crear una nueva?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 12, text: "Â¿Crees que los problemas personales de un empleado son irrelevantes y no deberÃ­an afectar la planificaciÃ³n ni los objetivos laborales del equipo?", scores: [{ skill: "Liderazgo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'attitude' },
    { id: 13, text: "Â¿Simplificas intencionalmente los detalles tÃ©cnicos complejos cuando hablas con personas no tÃ©cnicas para evitar confusiones, a pesar de la pÃ©rdida de precisiÃ³n?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }], scaleType: 'frequency' },
    { id: 14, text: "Cuando el equipo atraviesa una crisis o un error grave, Â¿logras mantener la moral alta y el enfoque positivo en la soluciÃ³n?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'frequency' },
    { id: 15, text: "Â¿Sueles trabajar en una sola tarea importante a la vez (Deep Work) o prefieres saltar entre varias tareas pequeÃ±as para sentirte productivo?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: -1 }], scaleType: 'frequency' },
    { id: 16, text: "Â¿Buscas activamente tutoriales o documentaciÃ³n avanzada sobre un tema, incluso si ya puedes resolver las tareas bÃ¡sicas con lo que sabes?", scores: [{ skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 17, text: "Â¿Modificas tu estilo de comunicaciÃ³n (formal/informal, directo/suave) segÃºn la personalidad o estado de Ã¡nimo de la persona con la que interactÃºas?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }], scaleType: 'frequency' },
    { id: 18, text: "Â¿Te sientes responsable de la formaciÃ³n y el crecimiento de tus compaÃ±eros, incluso si no eres su jefe directo?", scores: [{ skill: "Liderazgo", polarity: 1 }, { skill: "Proactividad", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }], scaleType: 'attitude' },
    { id: 19, text: "Â¿Evitas dar feedback negativo directo a un colega para preservar una relaciÃ³n armoniosa, prefiriendo comunicarlo indirectamente?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: -1 }, { skill: "Trabajo en equipo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'frequency' },
    { id: 20, text: "Cuando tienes una idea muy innovadora, Â¿el miedo al fracaso te detiene o te motiva a probarla?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }], scaleType: 'attitude' },
    { id: 21, text: "Â¿Tienes una lista clara de 'no hacer' para evitar distracciones durante tus bloques de trabajo mÃ¡s importantes?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: 1 }], scaleType: 'frequency' },
    { id: 22, text: "Â¿Consideras que el Ã©xito de un proyecto es la suma de los logros individuales o el resultado de la sinergia colectiva?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'attitude' },
    { id: 23, text: "Â¿Buscas datos y mÃ©tricas para validar tus suposiciones, incluso si tu intuiciÃ³n ya te dice cuÃ¡l es la respuesta correcta?", scores: [{ skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }], scaleType: 'frequency' },
    { id: 24, text: "Â¿Eres el primero en el equipo en experimentar con cambios en las herramientas del entorno de desarrollo, a pesar de los posibles errores que pueda causar a otros?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Trabajo en equipo", polarity: -1 }], scaleType: 'frequency' },
    { id: 25, text: "Â¿Cuando un colega habla, centras tu atenciÃ³n en lo que dice y no en lo que vas a responder a continuaciÃ³n?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }], scaleType: 'frequency' },
    { id: 26, text: "Â¿Tienes estrategias definidas (ej. ejercicio, pausas) para manejar picos de estrÃ©s que de otra forma afectarÃ­an tu productividad?", scores: [{ skill: "Resiliencia", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'frequency' },
    { id: 27, text: "Â¿Utilizas analogÃ­as o ideas de otros campos (arte, naturaleza) para explicar o resolver problemas tÃ©cnicos complejos?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }], scaleType: 'frequency' },
    { id: 28, text: "Â¿Te aseguras de que todos los involucrados en una decisiÃ³n crucial entiendan las implicaciones antes de proceder, no solo los directamente afectados?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'frequency' },
    { id: 29, text: "Si el equipo falla en un objetivo, Â¿asumes tu parte de la responsabilidad pÃºblicamente en lugar de enfocarte en las fallas ajenas?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }], scaleType: 'frequency' },
    { id: 30, text: "Antes de implementar una soluciÃ³n importante, Â¿suele ser necesario que un colega te cuestione para que encuentres los puntos dÃ©biles de tu diseÃ±o?", scores: [{ skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }, { skill: "Proactividad", polarity: -1 }], scaleType: 'frequency' },
    { id: 31, text: "Â¿Sientes que estÃ¡s perdiendo tiempo si pasas un dÃ­a entero aprendiendo una nueva librerÃ­a sin producir cÃ³digo para el proyecto actual?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: -1 }, { skill: "Aprendizaje continuo", polarity: -1 }], scaleType: 'attitude' },
    { id: 32, text: "Â¿Delegas tareas complejas, no solo las sencillas, para fomentar el crecimiento y la confianza de los miembros de tu equipo?", scores: [{ skill: "Liderazgo", polarity: 1 }, { skill: "Trabajo en equipo", polarity: 1 }], scaleType: 'frequency' },
    { id: 33, text: "Â¿Antes de intentar convencer a alguien de tu punto de vista, puedes resumir con precisiÃ³n la posiciÃ³n de la otra persona para demostrar que la entendiste?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }], scaleType: 'frequency' },
    { id: 34, text: "Â¿Te aburre profundamente trabajar siempre con la misma pila tecnolÃ³gica o el mismo tipo de proyecto?", scores: [{ skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Creatividad e innovaciÃ³n", polarity: 1 }], scaleType: 'attitude' },
    { id: 35, text: "Â¿Automatizas tareas repetitivas o manuales, incluso si te lleva mÃ¡s tiempo automatizarlas que hacerlas una vez?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'frequency' },
    { id: 36, text: "Tras un gran error, Â¿pasas rÃ¡pidamente de la autocrÃ­tica al anÃ¡lisis de los pasos concretos para prevenir que vuelva a ocurrir?", scores: [{ skill: "Resiliencia", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 37, text: "Â¿Dedicas tiempo a documentar y compartir tus nuevos aprendizajes para que el resto del equipo se beneficie?", scores: [{ skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }, { skill: "Trabajo en equipo", polarity: 1 }], scaleType: 'frequency' },
    { id: 38, text: "Â¿Buscas activamente a compaÃ±eros que estÃ¡n luchando con una tarea para ofrecerles ayuda, sin esperar a que te la pidan?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "EmpatÃ­a", polarity: 1 }, { skill: "Proactividad", polarity: 1 }], scaleType: 'frequency' },
    { id: 39, text: "Al escribir un mensaje o email importante, Â¿lo revisas dos veces para eliminar ambigÃ¼edades y asegurar la precisiÃ³n del mensaje?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 40, text: "Â¿Te molesta profundamente cuando tu rutina de trabajo se interrumpe por reuniones de Ãºltima hora o emergencias no planificadas?", scores: [{ skill: "Adaptabilidad al cambio", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }, { skill: "Resiliencia", polarity: -1 }], scaleType: 'attitude' }
];

// --- DATA COMPLETA DE PERFILES ---
const PROFILES = [
    { name: "EL ARQUITECTO ESTRATÃ‰GICO", skills: ["Liderazgo", "Pensamiento crÃ­tico y resoluciÃ³n de problemas", "ComunicaciÃ³n efectiva"], description: "Usted no solo dirige; define el futuro. Su habilidad para desglosar la complejidad, articular una visiÃ³n inspiradora y movilizar a las personas lo posiciona como un catalizador de transformaciÃ³n." },
    { name: "EL CONSTRUCTOR DE CULTURA", skills: ["Trabajo en equipo", "EmpatÃ­a", "ComunicaciÃ³n efectiva"], description: "Su mayor fortaleza es la inteligencia emocional. Usted es el engranaje humano del equipo, capaz de percibir tensiones, mediar conflictos y transformar grupos de individuos en equipos de alto rendimiento." },
    { name: "EL AGENTE DEL CAMBIO ÃGIL", skills: ["Adaptabilidad al cambio", "Resiliencia", "Aprendizaje continuo"], description: "Usted abraza la disrupciÃ³n. Su mente estÃ¡ programada para la mejora continua, viendo cada revÃ©s como un nuevo capÃ­tulo. Es el recurso ideal para entornos de alta incertidumbre." },
    { name: "EL VISIONARIO DISRUPTIVO", skills: ["Creatividad e innovaciÃ³n", "Proactividad", "Pensamiento crÃ­tico y resoluciÃ³n de problemas"], description: "Su motor es la eficiencia y la originalidad. Posee la habilidad de generar soluciones fuera del estÃ¡ndar y la disciplina para implementarlas sin esperar Ã³rdenes." },
    { name: "EL EJECUTOR DE ALTO RENDIMIENTO", skills: ["GestiÃ³n del tiempo", "Proactividad", "Resiliencia"], description: "Ejecuta con implacable eficiencia. Domina la priorizaciÃ³n, limpia obstÃ¡culos y se levanta inmediatamente tras un fallo. Es el motor que convierte planes en resultados." },
    { name: "EL PROFESIONAL INTEGRAL (360Â°)", skills: [], description: "Demuestra un balance excepcional en todas las Ã¡reas. Su perfil es adaptable a casi cualquier rol. Su prÃ³ximo paso es especializarse para maximizar su impacto." },
];

// --- DATA COMPLETA DE FEEDBACK DETALLADO ---
const SKILL_FEEDBACK = {
    "Liderazgo": {
        low: { weakness: "Evitas decisiones difÃ­ciles o delegar, lo que limita el crecimiento del equipo.", tip: "Implementa la 'DelegaciÃ³n de Empoderamiento': delega resultados, no solo tareas." },
        high: { strength: "Arquitecto de equipos. Empoderas y mantienes la moral alta.", tip: "Canalice esta fortaleza para el Liderazgo de Sistemas y mentorÃ­a de futuros lÃ­deres." },
    },
    "ComunicaciÃ³n efectiva": {
        low: { weakness: "Falta de claridad en mensajes complejos o evitaciÃ³n de feedback directo.", tip: "Usa la estructura SCQA (SituaciÃ³n, ComplicaciÃ³n, Pregunta, Respuesta) para mensajes clave." },
        high: { strength: "Mediador y traductor del equipo. Claridad excepcional.", tip: "Descentraliza tu conocimiento creando documentaciÃ³n y guÃ­as de comunicaciÃ³n." },
    },
    "Trabajo en equipo": {
        low: { weakness: "Tendencia a operar como 'llanero solitario', priorizando el logro individual.", tip: "Practica la responsabilidad colectiva. Pregunta 'Â¿QuÃ© podemos hacer nosotros?' no 'Â¿QuiÃ©n fallÃ³?'." },
        high: { strength: "Pegamento social del equipo. Priorizas la sinergia colectiva.", tip: "Establece un 'Acuerdo de ColaboraciÃ³n' formal para el equipo." },
    },
    "Adaptabilidad al cambio": {
        low: { weakness: "Resistencia pasiva o estrÃ©s ante cambios imprevistos.", tip: "Adopta el pensamiento Anti-FrÃ¡gil. Cambia intencionalmente una herramienta al mes para ganar plasticidad." },
        high: { strength: "Pivote natural. Ves el caos como oportunidad.", tip: "Lidera la evaluaciÃ³n de riesgos en nuevos proyectos y evangeliza la flexibilidad." },
    },
    "Resiliencia": {
        low: { weakness: "Dificultad para separarse emocionalmente del fracaso.", tip: "Usa el 'Protocolo de Error': 15 min de desahogo, luego anÃ¡lisis objetivo de pasos a seguir." },
        high: { strength: "RecuperaciÃ³n ejemplar. Mantienes la cabeza frÃ­a bajo presiÃ³n.", tip: "ActÃºa como el ancla emocional del equipo durante las crisis." },
    },
    "Pensamiento crÃ­tico y resoluciÃ³n de problemas": {
        low: { weakness: "Dependencia de la intuiciÃ³n sin validaciÃ³n de datos.", tip: "Aplica los '5 PorquÃ©s' para llegar a la causa raÃ­z de los problemas." },
        high: { strength: "Rigor analÃ­tico superior. Ves sistemas, no solo problemas.", tip: "Lidera la creaciÃ³n de Documentos de DecisiÃ³n ArquitectÃ³nica (ADR)." },
    },
    "Creatividad e innovaciÃ³n": {
        low: { weakness: "AversiÃ³n al riesgo limita la exploraciÃ³n de ideas nuevas.", tip: "Dedica 15 min semanales a la 'lluvia de ideas ciega' sin juzgar la viabilidad inicial." },
        high: { strength: "Fuente inagotable de enfoques novedosos.", tip: "Lidera la incubaciÃ³n de proyectos internos o pruebas de concepto (POCs)." },
    },
    "GestiÃ³n del tiempo": {
        low: { weakness: "El multitasking y la falta de priorizaciÃ³n reducen el trabajo profundo.", tip: "Implementa el 'Bloqueo de Tiempo Profundo' (2 horas sin interrupciones)." },
        high: { strength: "Dominio del tiempo y enfoque sostenible.", tip: "Automatiza flujos de trabajo del equipo para multiplicar tu eficiencia." },
    },
    "Proactividad": {
        low: { weakness: "Reactivo: esperas instrucciones antes de actuar.", tip: "Adopta el principio de 'DueÃ±o'. Arregla un problema pequeÃ±o sin que te lo pidan." },
        high: { strength: "Motor de la iniciativa. Anticipas riesgos.", tip: "Formaliza tu anticipaciÃ³n mediante anÃ¡lisis 'Pre-Mortem' de proyectos." },
    },
    "EmpatÃ­a": {
        low: { weakness: "DesconexiÃ³n con el factor humano y emocional.", tip: "Practica la escucha no evaluativa y el parafraseo empÃ¡tico." },
        high: { strength: "Inteligencia emocional elevada. Creas seguridad psicolÃ³gica.", tip: "DiseÃ±a la Experiencia del Desarrollador (DX) pensando en el usuario humano." },
    },
    "Aprendizaje continuo": {
        low: { weakness: "Aprendizaje utilitario y reactivo, solo lo necesario.", tip: "Establece la 'Hora de ExploraciÃ³n' semanal para temas fuera de tu zona de confort." },
        high: { strength: "Sed insaciable de conocimiento que compartes.", tip: "Formaliza la transferencia de conocimiento mediante charlas o blogs internos." },
    },
};

// --- VARIABLES GLOBALES ---
let currentQuestionIndex = 0;
let userAnswers = [];
let quizResults = null;

// --- ELEMENTOS DOM (Inicializados en initQuiz) ---
let quizEl, resultEl, questionsContainer, progressBarFill, progressText, prevBtn, nextBtn, submitBtn, alertModal, alertTitle, alertMessage, quizCardEl, goHomeFromQuiz, restartQuizBtn, topSkillsPillsEl, skillsList, profileNameEl, profileDescriptionEl, saveResultBtn;

// --- UTILIDADES ---
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function showAlertModal(title, message, isError = true) {
    if (!alertModal) return;
    if (alertTitle) alertTitle.textContent = title;
    if (alertMessage) alertMessage.textContent = message;
    
    const ctaBtn = alertModal.querySelector('.cta-btn');
    if (ctaBtn) {
        if (isError) {
            ctaBtn.classList.add('bg-red-600', 'hover:bg-red-700');
            ctaBtn.classList.remove('bg-emerald-600', 'hover:bg-emerald-700');
        } else {
            ctaBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            ctaBtn.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
        }
    }
    alertModal.classList.add('open');
}

window.closeAlertModal = function() {
    if (alertModal) alertModal.classList.remove('open');
}

function isQuizOnCooldown() {
    const lastCompletion = localStorage.getItem(LAST_QUIZ_KEY);
    if (!lastCompletion) return false;
    const lastDate = new Date(lastCompletion);
    const cooldownExpiry = new Date(lastDate.getTime() + COOLDOWN_DAYS * 24 * 60 * 60 * 1000);
    return new Date() < cooldownExpiry;
}

function getPreviousResult() {
    const result = localStorage.getItem(PREVIOUS_RESULT_KEY);
    return result ? JSON.parse(result) : null;
}

// --- CORE DEL QUIZ ---
function renderQuestion(index) {
    if (!questionsContainer) return;
    
    const loadingEl = document.getElementById('loading');
    if (loadingEl) loadingEl.style.display = 'none';
    
    questionsContainer.innerHTML = '';
    const questionData = QUIZ_DATA[index];
    const questionNumber = index + 1;
    const scale = ANSWER_SCALES[questionData.scaleType || DEFAULT_SCALE];

    questionsContainer.innerHTML = `
        <div class="question-item">
            <p class="question-text">(${questionNumber}/${QUIZ_DATA.length}) ${questionData.text}</p>
        </div>
        <div class="options-group" id="optionsGroup">
            ${scale.options.map((option, i) => `
                <button class="option-btn ${userAnswers[index] === (i + 1) ? 'selected' : ''}" 
                        data-value="${i + 1}">
                    ${option}
                </button>
            `).join('')}
        </div>
    `;

    document.getElementById('optionsGroup').addEventListener('click', handleOptionClick);
    updateUIState();
}

function handleOptionClick(e) {
    const target = e.target.closest('.option-btn');
    if (!target) return;

    Array.from(target.parentNode.children).forEach(btn => btn.classList.remove('selected'));
    target.classList.add('selected');

    const value = parseInt(target.dataset.value);
    userAnswers[currentQuestionIndex] = value;
    
    // Guardado parcial
    localStorage.setItem('quiz_progress_answers', JSON.stringify(userAnswers));
    localStorage.setItem('quiz_progress_index', currentQuestionIndex);

    // Avance automÃ¡tico
    setTimeout(() => {
        if (currentQuestionIndex < QUIZ_DATA.length - 1) {
            currentQuestionIndex++;
            renderQuestion(currentQuestionIndex);
        } else {
            updateUIState(); // Actualizar botones para mostrar "Finalizar"
        }
    }, 200);
}

function updateUIState() {
    // Barra de progreso
    const answered = userAnswers.filter(a => a !== null && a !== undefined).length;
    const pct = ((currentQuestionIndex + 1) / QUIZ_DATA.length) * 100;
    if (progressBarFill) progressBarFill.style.width = `${pct}%`;
    if (progressText) progressText.textContent = `PREGUNTA ${currentQuestionIndex + 1} DE ${QUIZ_DATA.length}`;

    // Botones
    if (prevBtn) prevBtn.style.display = currentQuestionIndex > 0 ? 'block' : 'none';
    
    const isLast = currentQuestionIndex === QUIZ_DATA.length - 1;
    const isAnswered = userAnswers[currentQuestionIndex] != null;

    if (nextBtn) nextBtn.style.display = (!isLast) ? 'block' : 'none';
    if (submitBtn) submitBtn.style.display = (isLast && isAnswered) ? 'block' : 'none';
}

function submitQuiz() {
    if (userAnswers.filter(a => a).length < QUIZ_DATA.length) {
        showAlertModal("Incompleto", "Por favor responde todas las preguntas.");
        return;
    }

    // 1. Calcular Puntajes
    const skillScores = {};
    const maxScores = {};
    
    // Inicializar
    Object.keys(SKILL_FEEDBACK).forEach(k => { skillScores[k] = 0; maxScores[k] = 0; });

    QUIZ_DATA.forEach((q, idx) => {
        const val = userAnswers[idx];
        q.scores.forEach(impact => {
            // Normalizar 1-5 a 0-4
            let score = (impact.polarity === 1) ? (val - 1) : (MAX_SCORE_PER_QUESTION_RAW - val);
            skillScores[impact.skill] += score;
            maxScores[impact.skill] += 4; // Max posible (5-1)
        });
    });

    // 2. Formatear Resultados
    const results = [];
    Object.keys(skillScores).forEach(skill => {
        const max = maxScores[skill];
        const pct = max > 0 ? Math.round((skillScores[skill] / max) * 100) : 0;
        results.push({ name: skill, percentage: pct });
    });
    
    results.sort((a, b) => b.percentage - a.percentage);
    
    // 3. Determinar Perfil
    let profile = PROFILES.find(p => p.name.includes("INTEGRAL"));
    const top3Names = results.slice(0,3).map(r => r.name);
    
    for (const p of PROFILES) {
        const matches = p.skills.filter(s => top3Names.includes(s)).length;
        if (matches >= 2) { profile = p; break; }
    }

    // 4. Construir Objeto Final
    quizResults = {
        skills: results,
        profile: profile,
        date: new Date().toISOString()
    };
    
    // Objeto para API (con nombres compatibles)
    window.finalQuizResult = {
        answers: userAnswers.reduce((acc, val, idx) => ({...acc, [`q${QUIZ_DATA[idx].id}`]: val}), {}),
        softSkills: results.map(r => ({ skill: r.name, score: r.percentage })),
        profile: profile.name,
        date: new Date().toISOString().split('T')[0],
        profileDescription: profile.description
    };

    localStorage.setItem(LAST_QUIZ_KEY, new Date().toISOString());
    localStorage.setItem(PREVIOUS_RESULT_KEY, JSON.stringify(quizResults));
    localStorage.removeItem('quiz_progress_answers');
    localStorage.removeItem('quiz_progress_index');

    renderResultsView();
}

function renderResultsView() {
    if (!quizEl || !resultEl) return;
    quizEl.style.display = 'none';
    resultEl.style.display = 'block';

    const { profile, skills } = quizResults;
    
    if (profileNameEl) profileNameEl.textContent = profile.name;
    if (profileDescriptionEl) profileDescriptionEl.textContent = profile.description;
    
    if (topSkillsPillsEl) {
        topSkillsPillsEl.innerHTML = skills.slice(0, 3).map(s => 
            `<span class="bg-emerald-600 text-white text-xs px-2 py-1 rounded-full shadow">${s.name}</span>`
        ).join('');
    }

    // ComparaciÃ³n
    const prev = getPreviousResult();
    let comparisonHTML = '';
    
    if (prev) {
        comparisonHTML = `<div class="p-4 bg-blue-900/30 rounded mb-4 border border-blue-800"><h4 class="font-bold text-blue-300">ğŸ“Š Comparativa</h4><p class="text-sm text-gray-300">Mostrando cambios vs tu Ãºltimo intento.</p></div>`;
    }

    const listHTML = skills.map(s => {
        const fb = SKILL_FEEDBACK[s.name];
        const isHigh = s.percentage >= 75;
        const detail = isHigh ? fb.high : fb.low;
        
        let diffDisplay = '';
        if (prev) {
            const oldSkill = prev.skills.find(os => os.name === s.name);
            if (oldSkill) {
                const diff = s.percentage - oldSkill.percentage;
                if (diff !== 0) {
                    const color = diff > 0 ? 'text-green-400' : 'text-red-400';
                    const arrow = diff > 0 ? 'â¬†' : 'â¬‡';
                    diffDisplay = `<span class="${color} text-sm font-bold ml-2">${arrow} ${Math.abs(diff)}%</span>`;
                }
            }
        }

        return `
        <div class="mb-6 p-5 bg-slate-800 rounded-lg border-l-4 ${isHigh ? 'border-emerald-500' : 'border-orange-500'} shadow-lg">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-lg font-bold text-white">${s.name}</h3>
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-white">${s.percentage}%</span>
                    ${diffDisplay}
                </div>
            </div>
            <div class="h-2 bg-slate-700 rounded-full mb-4 overflow-hidden">
                <div class="h-full ${isHigh ? 'bg-emerald-500' : 'bg-orange-500'} transition-all duration-1000" style="width: ${s.percentage}%"></div>
            </div>
            <div class="text-sm space-y-2">
                <p><strong class="${isHigh ? 'text-emerald-300' : 'text-orange-300'}">${isHigh ? 'Fortaleza:' : 'Punto de Mejora:'}</strong> <span class="text-gray-300">${detail.strength || detail.weakness}</span></p>
                <div class="mt-2 pt-2 border-t border-slate-700">
                    <p class="text-blue-300 font-semibold">ğŸ’¡ Consejo:</p>
                    <p class="text-gray-400 italic">${detail.tip}</p>
                </div>
            </div>
        </div>`;
    }).join('');

    if (skillsList) skillsList.innerHTML = comparisonHTML + listHTML;
    
    if (saveResultBtn) saveResultBtn.disabled = false;
}

async function saveResultsToAPI() {
    const token = localStorage.getItem('token');
    if (!token) return showAlertModal("Error", "Debes iniciar sesiÃ³n.", true);
    
    saveResultBtn.disabled = true;
    saveResultBtn.textContent = "Guardando...";
    
    try {
        const res = await fetch(`${API_URL}/api/quiz`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json', 
                'Authorization': `Bearer ${token}` 
            },
            body: JSON.stringify(window.finalQuizResult)
        });
        
        if (res.ok) {
            showAlertModal("Guardado", "Resultados guardados correctamente.", false);
            saveResultBtn.disabled = true;
            saveResultBtn.textContent = "Guardado";
        } else {
            throw new Error("Error en servidor");
        }
    } catch (e) {
        saveResultBtn.disabled = false;
        saveResultBtn.textContent = "Guardar Resultado";
        showAlertModal("Error", "No se pudo conectar con el servidor.", true);
    }
}

function restartQuiz() {
    localStorage.removeItem('quiz_progress_answers');
    localStorage.removeItem('quiz_progress_index');
    localStorage.removeItem(LAST_QUIZ_KEY); // Opcional: Eliminar para debug
    location.reload();
}

// --- INIT ---
document.addEventListener('DOMContentLoaded', () => {
    // Bind DOM elements
    quizEl = document.getElementById('quiz');
    resultEl = document.getElementById('result');
    questionsContainer = document.getElementById('questionsContainer');
    progressBarFill = document.getElementById('progressBarFill');
    progressText = document.getElementById('progressText');
    prevBtn = document.getElementById('prevBtn');
    nextBtn = document.getElementById('nextBtn');
    submitBtn = document.getElementById('submitBtn');
    alertModal = document.getElementById('alertModal');
    alertTitle = document.getElementById('alertTitle');
    alertMessage = document.getElementById('alertMessage');
    saveResultBtn = document.getElementById('saveResultBtn');
    backBtn = document.getElementById('backBtn');
    goHomeFromQuizBtn = document.getElementById('goHomeFromQuiz');
    loadingEl = document.getElementById('loading');
    topSkillsPillsEl = document.getElementById('topSkillsPills');
    skillsList = document.getElementById('skillsList');
    profileNameEl = document.getElementById('profileName');
    profileDescriptionEl = document.getElementById('profileDescription');
    restartQuizBtn = document.getElementById('restartQuizBtn');

    // Listeners
    if(backBtn) backBtn.onclick = () => window.location.href = 'home.html';
    if(goHomeFromQuizBtn) goHomeFromQuizBtn.onclick = () => window.location.href = 'home.html';
    if(prevBtn) prevBtn.onclick = () => { if(currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(currentQuestionIndex); }};
    if(nextBtn) nextBtn.onclick = () => { if(userAnswers[currentQuestionIndex]) { currentQuestionIndex++; renderQuestion(currentQuestionIndex); }};
    if(submitBtn) submitBtn.onclick = submitQuiz;
    if(saveResultBtn) saveResultBtn.onclick = saveResultsToAPI;
    if(restartQuizBtn) restartQuizBtn.onclick = restartQuiz;

    // Cooldown check
    if (isQuizOnCooldown()) {
        const saved = getPreviousResult();
        if (saved) {
            quizResults = saved;
            renderResultsView();
            showAlertModal("Modo Espera", `Debes esperar ${COOLDOWN_DAYS} dÃ­as. Se muestran tus resultados anteriores.`, false);
        } else {
            quizEl.innerHTML = `<div class="text-center text-white p-10"><h3>â³ Enfriamiento Activo</h3><p>Vuelve en unos dÃ­as.</p> <button onclick="window.location.href='home.html'" class="mt-4 btn bg-blue-600 p-2 rounded">Volver</button></div>`;
        }
        return;
    }

    // Load Progress & Start
    const savedAns = localStorage.getItem('quiz_progress_answers');
    if (savedAns) userAnswers = JSON.parse(savedAns);
    const savedIdx = localStorage.getItem('quiz_progress_index');
    if (savedIdx) currentQuestionIndex = parseInt(savedIdx);

    // Shuffle si es nuevo
    if (!savedAns) shuffleArray(QUIZ_DATA);
    
    renderQuestion(currentQuestionIndex);
});
    </script>
  </body>
</html>









