<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SoftSkills360 - Test de Habilidades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
    /* ğŸ¨ CONFIGURACIÃ“N GLOBAL - ESTILO OSCURO ESMERALDA */
:root {
  --color-primary: #10b981; /* Esmeralda 500 */
  --color-accent: #059669; /* Esmeralda 600 */
  --color-bg-dark: #0f172a; /* Fondo oscuro */
  --color-card-dark: #1e293b; /* Fondo de tarjetas */
  --color-text-light: #f8fafc; /* Texto claro */
  --color-border: #475569; /* Borde neutro */
}

.quiz-container {
  perspective: 1200px; /* ğŸ”¹ MÃ¡s profundidad */
}

.quiz-card {
  transform-style: preserve-3d;
  transition: transform 0.3s ease;
  will-change: transform;
}

body {
  font-family: "Inter", sans-serif;
  background-color: var(--color-bg-dark);
  min-height: 100vh;
  color: var(--color-text-light);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow-y: auto;
  margin: 0;
}

/* ğŸ”¹ NAVBAR */
.navbar {
  background-color: rgba(15, 23, 42, 0.9);
  backdrop-filter: blur(6px);
  border-bottom: 2px solid var(--color-primary);
  padding: 0.6rem 1.2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 20;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
}

.navbar h1 {
  font-size: 1.3rem;
  font-weight: 900;
  color: var(--color-text-light);
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
}

/* ğŸ§© CONTENEDOR DEL QUIZ */
.quiz-container {
  max-width: 700px;
  margin: 5rem auto 2rem auto;
  padding: 1rem;
  position: relative;
  perspective: 1000px;
  transform: scale(0.95);
}

/* ğŸ’« TARJETA DEL QUIZ */
.quiz-card,
.result-card {
  background-color: var(--color-card-dark);
  border: 1px solid var(--color-border);
  border-radius: 1rem;
  padding: 1.8rem;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
  transition: all 0.5s ease, box-shadow 0.3s ease;
  animation: popCard 0.6s ease forwards;
}

.quiz-card:hover {
  transform: scale(1.01);
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
}

@keyframes popCard {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* ğŸ”¸ BARRA DE PROGRESO */
.progress-bar {
  width: 100%;
  height: 8px;
  background: #334155; /* gris azulado */
  border-radius: 9999px;
  margin-bottom: 1rem;
}

.progress-fill {
  background: var(--color-primary);
  height: 8px;
  width: 0%;
  border-radius: 9999px;
  box-shadow: 0 0 10px var(--color-primary);
  transition: width 0.6s ease-in-out;
}

/* â“ PREGUNTA */
.question-item {
  text-align: center;
}

.question-item p {
  font-size: 1.6rem;
  font-weight: 800;
  color: var(--color-text-light);
  margin-bottom: 1.2rem;
  text-shadow: 0 0 6px rgba(16, 185, 129, 0.4);
}

/* âš¡ OPCIONES */
.options-group {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.8rem;
  margin-top: 1rem;
}

.option-btn {
  background-color: #334155;
  border: 1px solid var(--color-border);
  color: var(--color-text-light);
  padding: 0.6rem 1.4rem;
  font-size: 1rem;
  font-weight: 700;
  border-radius: 0.6rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 120px;
  max-width: 220px;
  text-align: center;
}

.option-btn:hover {
  background-color: #475569;
  transform: scale(1.05);
  box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
}

.option-btn.selected {
  background: var(--color-primary);
  color: #0f172a;
  border: 2px solid white;
  font-weight: 900;
  transform: scale(1.08);
  box-shadow: 0 0 10px var(--color-primary);
}

/* ğŸ”» BOTONES DE ACCIÃ“N */
.quiz-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.cta-btn {
  background-color: var(--color-primary);
  color: #0f172a;
  font-weight: 900;
  padding: 0.7rem 1.6rem;
  border-radius: 0.6rem;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
  font-size: 0.95rem;
}

.cta-btn:hover {
  background-color: var(--color-accent);
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
}

.secondary-btn {
  background-color: #334155;
  color: var(--color-text-light);
  font-weight: 700;
  padding: 0.7rem 1.6rem;
  border-radius: 0.6rem;
  transition: all 0.3s ease;
  font-size: 0.95rem;
}

.secondary-btn:hover {
  background-color: #475569;
  transform: scale(1.03);
}

/* ğŸ’¬ RESULTADOS */
.result-card {
  text-align: center;
  padding: 1.8rem;
  margin-bottom: 2rem;
}

.result-card .text-emerald-500 {
  font-size: 1.8rem;
  font-weight: 900;
  color: var(--color-primary);
  text-shadow: 0 0 8px rgba(16, 185, 129, 0.7);
}

.result-card p {
  font-size: 1rem;
  color: #d1d5db;
}

.skill-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.4rem 0;
}

.skill-name {
  font-weight: 600;
  color: var(--color-text-light);
  width: 30%;
  text-align: left;
}

.skill-bar-container {
  flex-grow: 1;
  height: 8px;
  background-color: #334155;
  border-radius: 9999px;
  overflow: hidden;
}

.skill-bar {
  height: 100%;
  background-color: var(--color-primary);
  transition: width 0.5s ease-out;
  box-shadow: 0 0 4px rgba(16, 185, 129, 0.6);
}

/* Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 50;
  opacity: 0; /* Controlado por JS */
  visibility: hidden; /* Controlado por JS */
  transition: opacity 0.3s ease;
}

.modal-overlay.open {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background-color: var(--color-card-dark);
  padding: 1.5rem;
  border-radius: 1rem;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  max-width: 380px;
  text-align: center;
  border: 2px solid var(--color-primary);
}

.modal-content h3 {
  font-size: 1.3rem;
  font-weight: 800;
  color: var(--color-primary);
  margin-bottom: 0.8rem;
}

/* ğŸŒŸ EFECTO DE FONDO */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(
    circle at 50% 50%,
    rgba(16, 185, 129, 0.06) 0%,
    transparent 70%
  );
  z-index: -1;
}

/* ğŸ“± RESPONSIVIDAD */
@media (max-width: 640px) {
  .question-item p {
    font-size: 1.3rem;
  }

  .option-btn {
    width: 100%;
  }

  .quiz-card,
  .result-card {
    padding: 1.5rem;
  }

  .cta-btn,
  .secondary-btn {
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
  }
}
    </style>
  </head>
<body>
Â  Â  <header class="navbar">
Â  Â  Â  <h1>Habilidades Blandas</h1>
Â  Â  Â  <button id="backBtn" class="secondary-btn p-2 px-4">Volver</button>
Â  Â  </header>

Â  Â  <main class="quiz-container">
Â  Â  Â  <div id="quiz" class="quiz-card">
Â  Â  Â  Â  <h2 class="text-4xl font-extrabold text-center mb-8 text-white">
Â  Â  Â  Â  Â  INICIANDO ANÃLISIS DE HABILIDADES
Â  Â  Â  Â  </h2>

Â  Â  Â  Â  <div class="progress-bar">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  id="progressBarFill"
Â  Â  Â  Â  Â  Â  class="progress-fill"
Â  Â  Â  Â  Â  Â  style="width: 0%"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  id="questionsContainer"
Â  Â  Â  Â  Â  class="min-h-[250px] flex items-center justify-center"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div id="loading" class="text-gray-400 text-lg">
Â  Â  Â  Â  Â  Â  Cargando preguntas...
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="quiz-actions">
Â  Â  Â  Â  Â  <button id="prevBtn" class="secondary-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Anterior
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="nextBtn" class="cta-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Siguiente
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="submitBtn" class="cta-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Finalizar Test
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="progress-footer text-center mt-4">
Â  Â  Â  Â  <p
Â  Â  Â  Â  Â  id="progressText"
Â  Â  Â  Â  Â  class="text-lg font-mono text-emerald-400 tracking-wider"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Cargando...
Â  Â  Â  Â  </p>
Â  Â  Â  </div>

Â  Â  Â  <div id="result" class="result-card" style="display: none">
Â  Â  Â  Â  <h3 class="text-4xl font-extrabold text-center mb-6 text-emerald-500">
Â  Â  Â  Â  ğŸš€ :: RESULTADOS FINALES :: ğŸš€
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div id="resultContent" class="text-gray-300">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="bg-gray-900/50 p-6 rounded-xl mb-8 border border-emerald-600/50"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <p class="text-lg font-medium mb-2 text-gray-400">
Â  Â  Â  Â  Â  Â  Â  PERFIL DETERMINADO:
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <h4
Â  Â  Â  Â  Â  Â  Â  id="profileName"
Â  Â  Â  Â  Â  Â  Â  class="text-3xl font-extrabold text-emerald-400"
Â  Â  Â  Â  Â  Â  ></h4>
Â  Â  Â  Â  Â  Â  <p id="profileDescription" class="mt-3 text-gray-400 italic"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="topSkillsPills" class="mt-4 flex flex-wrap gap-2"></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <h4
Â  Â  Â  Â  Â  Â  class="text-2xl font-bold mt-8 mb-4 border-b pb-2 border-slate-700/50 text-white"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  MÃ‰TRICAS DE HABILIDAD (0-100)
Â  Â  Â  Â  Â  </h4>
Â  Â  Â  Â  Â  <div id="skillsList" class="space-y-3">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="mt-10 text-center">
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="saveResultBtn"
Â  Â  Â  Â  Â  Â  class="cta-btn disabled:opacity-50"
Â  Â  Â  Â  Â  Â  disabled
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Guardar Resultado
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="goHomeFromQuiz" class="secondary-btn ml-4">
Â  Â  Â  Â  Â  Â  Volver al Inicio
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button 
Â  Â  Â  Â  Â  Â  id="restartQuizBtn" 
Â  Â  Â  Â  Â  Â  class="secondary-btn ml-4 bg-yellow-600 hover:bg-yellow-700 text-white"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Repetir Test
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="alertModal" class="modal-overlay">
Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h3 id="alertTitle">Â¡ALERTA DE SISTEMA!</h3>
Â  Â  Â  Â  <p id="alertMessage" class="text-gray-300">Mensaje de prueba.</p>
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  class="cta-btn bg-red-600 hover:bg-red-700 mt-6 text-white"
Â  Â  Â  Â  Â  onclick="closeAlertModal()"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ACECEPTAR
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>

    <script>
     const API_URL = "https://encuestaa.onrender.com"; // URL de tu API de FastAPI en Render

// --- CONFIGURACIÃ“N DE ESCALA Y ALMACENAMIENTO ---
const MAX_SCORE_PER_QUESTION_RAW = 5;
const COOLDOWN_DAYS = 7;
const LAST_QUIZ_KEY = 'lastQuizCompletion';
const PREVIOUS_RESULT_KEY = 'previousQuizResult';

// --- NUEVAS ESCALAS CONTEXTUALES DE RESPUESTA ---
const ANSWER_SCALES = {
    // Escala A: Actitud/Prioridad (para preguntas de opiniÃ³n o reacciÃ³n)
    'attitude': {
        "Totalmente en desacuerdo": 1,
        "En desacuerdo": 2,
        "Neutral/Depende": 3,
        "De acuerdo": 4,
        "Totalmente de acuerdo": 5,
        options: ["Totalmente en desacuerdo", "En desacuerdo", "Neutral/Depende", "De acuerdo", "Totalmente de acuerdo"]
    },
    // Escala B: Frecuencia (para preguntas de hÃ¡bito o acciÃ³n)
    'frequency': {
        "Casi nunca lo hago": 1,
        "Raramente lo hago": 2,
        "A veces lo hago": 3,
        "Lo hago frecuentemente": 4,
        "Casi siempre lo hago": 5,
        options: ["Casi nunca lo hago", "Raramente lo hago", "A veces lo hago", "Lo hago frecuentemente", "Casi siempre lo hago"]
    }
};
const DEFAULT_SCALE = 'frequency';

// --- DATA DEL QUIZ (40 preguntas de escaneo MULTIFACTORIAL con 'scaleType') ---
const QUIZ_DATA = [
Â  { id: 1, text: "Al inicio de un proyecto, Â¿dedicas mÃ¡s tiempo a la planificaciÃ³n detallada (milestones, dependencias) que a la ejecuciÃ³n inmediata?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 2, text: "Si un requisito clave de un cliente cambia a Ãºltima hora, Â¿te frustras o lo ves como una oportunidad para demostrar flexibilidad?", scores: [{ skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'attitude' },
Â  { id: 3, text: "En una reuniÃ³n de ideas, Â¿sientes que es tu deber seÃ±alar los defectos de una idea 'loca' en lugar de intentar mejorarla?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: -1 }], scaleType: 'attitude' },
Â  { id: 4, text: "Â¿Buscas tomar todas las decisiones importantes del equipo para asegurar que se hagan 'bien', restando autonomÃ­a a tus compaÃ±eros?", scores: [{ skill: "Liderazgo", polarity: -1 }, { skill: "Trabajo en equipo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'frequency' },
Â  { id: 5, text: "Cuando un colega te pide ayuda o te explica un problema, Â¿le interrumpes para ofrecerle la soluciÃ³n apenas crees entender la causa?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }], scaleType: 'frequency' },
Â  { id: 6, text: "Â¿Realizas o exploras una nueva herramienta o curso por iniciativa propia, incluso si no tiene una aplicaciÃ³n directa en tu trabajo actual?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Creatividad e innovaciÃ³n", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 7, text: "Si fallas un plazo importante, Â¿te cuesta dÃ­as recuperarte emocionalmente y volver a concentrarte en otras tareas?", scores: [{ skill: "Resiliencia", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }], scaleType: 'attitude' },
Â  { id: 8, text: "En un debate intenso, Â¿priorizas alcanzar un acuerdo que satisfaga a todos sobre imponer tu punto de vista lÃ³gicamente superior?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }], scaleType: 'attitude' },
Â  { id: 9, text: "Â¿Te sientes muy incÃ³modo cuando un software o proceso que dominas es reemplazado por uno nuevo sin previo aviso?", scores: [{ skill: "Adaptabilidad al cambio", polarity: -1 }, { skill: "Aprendizaje continuo", polarity: -1 }, { skill: "Resiliencia", polarity: -1 }], scaleType: 'attitude' },
Â  { id: 10, text: "Â¿Eres de los que prefiere 'pedir perdÃ³n antes que permiso' cuando ves una oportunidad clara de mejora o eficiencia?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'attitude' },
Â  { id: 11, text: "Â¿Ante un problema conocido, primero revisas si existe un proceso o soluciÃ³n estÃ¡ndar, antes de intentar crear una nueva?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 12, text: "Â¿Crees que los problemas personales de un empleado son irrelevantes y no deberÃ­an afectar la planificaciÃ³n ni los objetivos laborales del equipo?", scores: [{ skill: "Liderazgo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'attitude' },
Â  { id: 13, text: "Â¿Simplificas intencionalmente los detalles tÃ©cnicos complejos cuando hablas con personas no tÃ©cnicas para evitar confusiones, a pesar de la pÃ©rdida de precisiÃ³n?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }], scaleType: 'frequency' },
Â  { id: 14, text: "Cuando el equipo atraviesa una crisis o un error grave, Â¿logras mantener la moral alta y el enfoque positivo en la soluciÃ³n?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 15, text: "Â¿Sueles trabajar en una sola tarea importante a la vez (Deep Work) o prefieres saltar entre varias tareas pequeÃ±as para sentirte productivo?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: -1 }], scaleType: 'frequency' },
Â  { id: 16, text: "Â¿Buscas activamente tutoriales o documentaciÃ³n avanzada sobre un tema, incluso si ya puedes resolver las tareas bÃ¡sicas con lo que sabes?", scores: [{ skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 17, text: "Â¿Modificas tu estilo de comunicaciÃ³n (formal/informal, directo/suave) segÃºn la personalidad o estado de Ã¡nimo de la persona con la que interactÃºas?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 18, text: "Â¿Te sientes responsable de la formaciÃ³n y el crecimiento de tus compaÃ±eros, incluso si no eres su jefe directo?", scores: [{ skill: "Liderazgo", polarity: 1 }, { skill: "Proactividad", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }], scaleType: 'attitude' },
Â  { id: 19, text: "Â¿Evitas dar feedback negativo directo a un colega para preservar una relaciÃ³n armoniosa, prefiriendo comunicarlo indirectamente?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: -1 }, { skill: "Trabajo en equipo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'frequency' },
Â  { id: 20, text: "Cuando tienes una idea muy innovadora, Â¿el miedo al fracaso te detiene o te motiva a probarla?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }], scaleType: 'attitude' },
Â  { id: 21, text: "Â¿Tienes una lista clara de 'no hacer' para evitar distracciones durante tus bloques de trabajo mÃ¡s importantes?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 22, text: "Â¿Consideras que el Ã©xito de un proyecto es la suma de los logros individuales o el resultado de la sinergia colectiva?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'attitude' },
Â  { id: 23, text: "Â¿Buscas datos y mÃ©tricas para validar tus suposiciones, incluso si tu intuiciÃ³n ya te dice cuÃ¡l es la respuesta correcta?", scores: [{ skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 24, text: "Â¿Eres el primero en el equipo en experimentar con cambios en las herramientas del entorno de desarrollo, a pesar de los posibles errores que pueda causar a otros?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Trabajo en equipo", polarity: -1 }], scaleType: 'frequency' },
Â  { id: 25, text: "Â¿Cuando un colega habla, centras tu atenciÃ³n en lo que dice y no en lo que vas a responder a continuaciÃ³n?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 26, text: "Â¿Tienes estrategias definidas (ej. ejercicio, pausas) para manejar picos de estrÃ©s que de otra forma afectarÃ­an tu productividad?", scores: [{ skill: "Resiliencia", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 27, text: "Â¿Utilizas analogÃ­as o ideas de otros campos (arte, naturaleza) para explicar o resolver problemas tÃ©cnicos complejos?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 28, text: "Â¿Te aseguras de que todos los involucrados en una decisiÃ³n crucial entiendan las implicaciones antes de proceder, no solo los directamente afectados?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 29, text: "Si el equipo falla en un objetivo, Â¿asumes tu parte de la responsabilidad pÃºblicamente en lugar de enfocarte en las fallas ajenas?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 30, text: "Antes de implementar una soluciÃ³n importante, Â¿suele ser necesario que un colega te cuestione para que encuentres los puntos dÃ©biles de tu diseÃ±o?", scores: [{ skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }, { skill: "Proactividad", polarity: -1 }], scaleType: 'frequency' },
Â  { id: 31, text: "Â¿Sientes que estÃ¡s perdiendo tiempo si pasas un dÃ­a entero aprendiendo una nueva librerÃ­a sin producir cÃ³digo para el proyecto actual?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: -1 }, { skill: "Aprendizaje continuo", polarity: -1 }], scaleType: 'attitude' },
Â  { id: 32, text: "Â¿Delegas tareas complejas, no solo las sencillas, para fomentar el crecimiento y la confianza de los miembros de tu equipo?", scores: [{ skill: "Liderazgo", polarity: 1 }, { skill: "Trabajo en equipo", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 33, text: "Â¿Antes de intentar convencer a alguien de tu punto de vista, puedes resumir con precisiÃ³n la posiciÃ³n de la otra persona para demostrar que la entendiste?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 34, text: "Â¿Te aburre profundamente trabajar siempre con la misma pila tecnolÃ³gica o el mismo tipo de proyecto?", scores: [{ skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Creatividad e innovaciÃ³n", polarity: 1 }], scaleType: 'attitude' },
Â  { id: 35, text: "Â¿Automatizas tareas repetitivas o manuales, incluso si te lleva mÃ¡s tiempo automatizarlas que hacerlas una vez?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 36, text: "Tras un gran error, Â¿pasas rÃ¡pidamente de la autocrÃ­tica al anÃ¡lisis de los pasos concretos para prevenir que vuelva a ocurrir?", scores: [{ skill: "Resiliencia", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 37, text: "Â¿Dedicas tiempo a documentar y compartir tus nuevos aprendizajes para que el resto del equipo se beneficie?", scores: [{ skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }, { skill: "Trabajo en equipo", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 38, text: "Â¿Buscas activamente a compaÃ±eros que estÃ¡n luchando con una tarea para ofrecerles ayuda, sin esperar a que te la pidan?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "EmpatÃ­a", polarity: 1 }, { skill: "Proactividad", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 39, text: "Al escribir un mensaje o email importante, Â¿lo revisas dos veces para eliminar ambigÃ¼edades y asegurar la precisiÃ³n del mensaje?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
Â  { id: 40, text: "Â¿Te molesta profundamente cuando tu rutina de trabajo se interrumpe por reuniones de Ãºltima hora o emergencias no planificadas?", scores: [{ skill: "Adaptabilidad al cambio", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }, { skill: "Resiliencia", polarity: -1 }], scaleType: 'attitude' }
];

// --- DATA DE PERFILES (SIN CAMBIOS) ---
const PROFILES = [
    // ... (Mantener la data de PROFILES y SKILL_FEEDBACK sin cambios) ...
Â  { name: "EL LÃDER ESTRATÃ‰GICO", skills: ["Liderazgo", "Pensamiento crÃ­tico y resoluciÃ³n de problemas", "ComunicaciÃ³n efectiva"], description: "Un lÃ­der natural con la capacidad de analizar problemas complejos y dirigir al equipo hacia metas claras. Excelente para la toma de decisiones y la gestiÃ³n de la visiÃ³n." },
Â  { name: "EL COLABORADOR INFLUYENTE", skills: ["Trabajo en equipo", "EmpatÃ­a", "ComunicaciÃ³n efectiva"], description: "Eres el puente del equipo. Entiendes las dinÃ¡micas humanas, comunicas eficazmente y garantizas que el equipo trabaje en armonÃ­a. Ideal para roles de Scrum Master o coordinaciÃ³n." },
Â  { name: "EL AGENTE DE CAMBIO ÃGIL", skills: ["Adaptabilidad al cambio", "Resiliencia", "Aprendizaje continuo"], description: "Prosperas en ambientes dinÃ¡micos. Tu capacidad de recuperarte de los reveses y tu apetito por aprender te convierten en un recurso invaluable para proyectos en evoluciÃ³n constante o startups." },
Â  { name: "EL INNOVADOR PROACTIVO", skills: ["Creatividad e innovaciÃ³n", "Proactividad", "Pensamiento crÃ­tico y resoluciÃ³n de problemas"], description: "No esperas problemas; los previenes. Tu mente genera soluciones originales y tomas la iniciativa para implementarlas, optimizando constantemente el trabajo y procesos." },
Â  { name: "EL EJECUTOR ENFOCADO", skills: ["GestiÃ³n del tiempo", "Proactividad", "Resiliencia"], description: "Posees una disciplina excepcional. Eres experto en priorizar y cumplir plazos, superando cualquier obstÃ¡culo gracias a tu tenacidad y enfoque en el resultado. Ideal para roles de alto rendimiento." },
Â  { name: "EL DESARROLLADOR INTEGRAL", skills: [], description: "Tienes un equilibrio fuerte entre tus habilidades blandas, mostrando potencial en diversas Ã¡reas. Tu adaptabilidad y enfoque te harÃ¡n exitoso." },
];

const SKILL_FEEDBACK = {
    // ... (Mantener la data de SKILL_FEEDBACK sin cambios) ...
Â  "Liderazgo": {
Â  Â  low: { weakness: "Evitas decisiones difÃ­ciles y no logras establecer una direcciÃ³n clara, impactando la moral y la autonomÃ­a del equipo.", tip: "Asume responsabilidades de la 'visiÃ³n'. Practica delegar tareas complejas y ofrece *mentorÃ­a* en lugar de hacer *micromanagement*." },
Â  Â  high: { strength: "LÃ­der inspirador que empodera. Tu visiÃ³n y tu capacidad para mantener la moral alta son tus mayores fortalezas.", tip: "EnfÃ³cate en desarrollar futuros lÃ­deres. Crea sistemas de delegaciÃ³n basados en la confianza para multiplicar el impacto." },
Â  },
Â  "ComunicaciÃ³n efectiva": {
Â  Â  low: { weakness: "Tienes dificultades para transmitir mensajes tÃ©cnicos a no tÃ©cnicos o evitas el *feedback* directo, generando ambigÃ¼edad.", tip: "Aplica la regla 'Antes de hablar, escucha el doble'. Estructura tu mensaje: 1. Resultado 2. Contexto 3. Pasos, para mÃ¡xima claridad." },
Â  Â  high: { strength: "Claro y activo. Tu capacidad para la escucha y claridad al articular ideas complejas te convierte en el puente de informaciÃ³n clave.", tip: "Utiliza esta fortaleza para mediar conflictos y documentar procesos, asegurando que todos los involucrados estÃ©n siempre alineados." },
Â  },
Â  "Trabajo en equipo": {
Â  Â  low: { weakness: "Priorizas el logro individual, te cuesta el consenso o evitas asumir responsabilidad por fallas colectivas del grupo.", tip: "Adopta la **responsabilidad colectiva**. DespuÃ©s de un error, enfÃ³cate en 'Â¿QuÃ© podemos hacer *ahora*?' y no en 'Â¿QuiÃ©n fallÃ³?'." },
Â  Â  high: { strength: "Pilar de la sinergia. Tu actitud colaborativa y enfoque en el Ã©xito colectivo mejoran drÃ¡sticamente la productividad grupal.", tip: "Invierte tu energÃ­a en la mentorÃ­a y en la integraciÃ³n de nuevos miembros para asegurar que la cultura de colaboraciÃ³n se mantenga." },
Â  },
Â  "Adaptabilidad al cambio": {
Â  Â  low: { weakness: "La rigidez en tus procesos o la aversiÃ³n a las interrupciones te causan estrÃ©s ante cambios tecnolÃ³gicos o de requisitos imprevistos.", tip: "Define el 20% de elementos del proyecto que *sabes* que cambiarÃ¡n (ej. librerÃ­as externas) y planifica su desarrollo con la flexibilidad en mente." },
Â  Â  high: { strength: "Prosperas en ambientes dinÃ¡micos. Los cambios son oportunidades para demostrar tu flexibilidad y habilidad para pivotar rÃ¡pidamente.", tip: "SÃ© el 'agente de cambio'. Lidera la adopciÃ³n de nuevas herramientas o procesos, ayudando al equipo a superar la resistencia." },
Â  },
Â  "Resiliencia": {
Â  Â  low: { weakness: "Los contratiempos o crÃ­ticas afectan tu estado emocional por dÃ­as, dificultando la recuperaciÃ³n de tu enfoque y productividad.", tip: "Implementa un **'Plan Post-Error'**. DespuÃ©s de un fallo, dedica 10 minutos a la frustraciÃ³n y luego, inmediatamente, lista: 1. LecciÃ³n aprendida. 2. AcciÃ³n preventiva. 3. Siguiente tarea." },
Â  Â  high: { strength: "RecuperaciÃ³n notable. Utilizas el fracaso como una herramienta de anÃ¡lisis para el Ã©xito futuro, manteniendo la calma bajo presiÃ³n.", tip: "Modela la forma correcta de manejar un error. Ayuda a establecer una cultura de seguridad psicolÃ³gica donde los errores se ven como lecciones de crecimiento." },
Â  },
Â  "Pensamiento crÃ­tico y resoluciÃ³n de problemas": {
Â  Â  low: { weakness: "Aceptas soluciones obvias sin validaciÃ³n de datos o dependes de otros para que encuentren los puntos dÃ©biles de tu lÃ³gica.", tip: "Antes de implementar, formula tres escenarios 'Â¿QuÃ© pasa si...?' que intenten *romper* tu soluciÃ³n. Busca datos rigurosos que prueben tus suposiciones, no solo las confirmen." },
Â  Â  high: { strength: "Mente analÃ­tica que desmantela problemas complejos y encuentra soluciones robustas. Siempre buscas validar las suposiciones con datos.", tip: "Canaliza esta habilidad para resolver los problemas de 'raÃ­z' (el 20% que causan el 80% de los errores). Crea documentos de decisiÃ³n basados en datos." },
Â  },
Â  "Creatividad e innovaciÃ³n": {
Â  Â  low: { weakness: "Prefieres soluciones probadas y tiendes a descartar ideas no convencionales demasiado pronto, limitando el potencial innovador.", tip: "Implementa 'juegos de ideas'. Elige un problema y obliga a tu mente a solucionarlo usando una analogÃ­a aleatoria (ej. un animal, un deporte). Elimina el juicio por 15 minutos." },
Â  Â  high: { strength: "Motor de ideas. Siempre buscas enfoques no convencionales y disfrutas saliendo de la caja de soluciones estÃ¡ndar.", tip: "Asegura la viabilidad de tus ideas. DiseÃ±a y prueba *Minimum Viable Products (MVPs)* rÃ¡pidos para demostrar el valor de tus propuestas mÃ¡s arriesgadas." },
Â  },
Â  "GestiÃ³n del tiempo": {
Â  Â  low: { weakness: "El *multitasking*, la falta de lÃ­mites o el *context-switching* frecuente reducen drÃ¡sticamente tu rendimiento en tareas profundas.", tip: "Practica el **Bloqueo de Tiempo Profundo (Deep Work)**. Reserva 2 horas diarias sin interrupciones (silencia notificaciones, usa un *focus timer*) para tu tarea mÃ¡s importante. El enfoque es tu mayor activo." },
Â  Â  high: { strength: "Disciplina excepcional. Tu habilidad para priorizar y bloquear el tiempo te hace excepcionalmente eficiente en el trabajo profundo.", tip: "Comparte tus mÃ©todos de productividad con tu equipo. Busca automatizar procesos que roban tiempo a otros (ej. reportes, revisiÃ³n de cÃ³digo)." },
Â  },
Â  "Proactividad": {
Â  Â  low: { weakness: "Esperas instrucciones claras o permisos antes de actuar, lo que te hace dependiente y ralentiza la resoluciÃ³n de problemas.", tip: "Identifica un proceso 'roto' y haz un plan de soluciÃ³n de **bajo riesgo**. Presenta la soluciÃ³n a tu lÃ­der diciendo: 'Lo hice de esta forma, Â¿quÃ© te parece?' (Pedir perdÃ³n es mejor que pedir permiso, con cautela)." },
Â  Â  high: { strength: "Agente de cambio. Tomas la iniciativa para mejorar procesos, automatizar tareas y explorar soluciones por tu cuenta.", tip: "Canaliza tu proactividad en la mejora continua de la documentaciÃ³n y la detecciÃ³n de riesgos futuros para la empresa." },
Â  },
Â  "EmpatÃ­a": {
Â  Â  low: { weakness: "Te centras en la lÃ³gica y la tarea, ignorando el impacto emocional o las necesidades sociales de tus compaÃ±eros, tensando las relaciones.", tip: "Antes de ofrecer una soluciÃ³n en un conflicto, usa el **Parafraseo EmpÃ¡tico**: 'Entiendo que tu preocupaciÃ³n es X. Â¿Es correcto?'. Valida el sentimiento antes de ofrecer la lÃ³gica." },
Â  Â  high: { strength: "Inteligencia emocional avanzada. Entiendes y anticipas las necesidades de los demÃ¡s, creando ambientes de trabajo positivos.", tip: "Utiliza esta habilidad para ser mentor y para diseÃ±ar flujos de trabajo (workflows) que sean intuitivos y considerados con el factor humano." },
Â  },
Â  "Aprendizaje continuo": {
Â  Â  low: { weakness: "Te limitas a aprender lo estrictamente necesario. Ves la inversiÃ³n de tiempo en nueva tecnologÃ­a no relacionada como una distracciÃ³n.", tip: "Establece la **'Hora de ExploraciÃ³n'** semanal. Dedica 60 minutos a leer sobre una librerÃ­a o tecnologÃ­a que no usas, sin la presiÃ³n de aplicarla inmediatamente. Simplemente 'juega'." },
Â  Â  high: { strength: "Sed insaciable por el conocimiento. Buscas activamente informaciÃ³n avanzada y la compartes, elevando el nivel tÃ©cnico colectivo.", tip: "Formaliza tus nuevos aprendizajes. Da una pequeÃ±a charla interna o crea un repositorio de recursos clave para el equipo." },
Â  },
};

// --- ESTADO Y UTILERIAS (SIN CAMBIOS) ---
let currentQuestionIndex = 0;
const userAnswers = {};
window.finalQuizResult = null;

// Elementos del DOM
const questionsContainer = document.getElementById('questionsContainer');
const progressText = document.getElementById('progressText');
const progressBarFill = document.getElementById('progressBarFill');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const quizCard = document.getElementById('quiz');
const resultCard = document.getElementById('result');
const skillsList = document.getElementById('skillsList');
const profileNameEl = document.getElementById('profileName');
const profileDescriptionEl = document.getElementById('profileDescription');
const alertModal = document.getElementById('alertModal');
const alertTitle = document.getElementById('alertTitle');
const alertMessage = document.getElementById('alertMessage');
const saveResultBtn = document.getElementById('saveResultBtn');
const backBtn = document.getElementById('backBtn');
const goHomeFromQuizBtn = document.getElementById('goHomeFromQuiz');
const loadingEl = document.getElementById('loading');
const topSkillsPillsEl = document.getElementById('topSkillsPills');


/** FunciÃ³n utilitaria para mezclar un array. */
function shuffleArray(array) {
Â  for (let i = array.length - 1; i > 0; i--) {
Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  [array[i], array[j]] = [array[j], array[i]];
Â  }
}

/** Muestra un modal de alerta personalizado. */
function showAlert(title, message, isError = true) {
Â  if (alertTitle) alertTitle.textContent = title;
Â  if (alertMessage) alertMessage.textContent = message;
Â  const ctaBtn = alertModal ? alertModal.querySelector('.cta-btn') : null;

Â  if (ctaBtn) {
Â  Â  if (isError) {
Â  Â  Â  ctaBtn.classList.add('bg-red-600', 'hover:bg-red-700');
Â  Â  Â  ctaBtn.classList.remove('bg-emerald-600', 'hover:bg-emerald-700');
Â  Â  } else {
Â  Â  Â  ctaBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
Â  Â  Â  ctaBtn.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
Â  Â  }
Â  }
Â  if (alertModal) alertModal.classList.add('open');
}

/** Cierra el modal de alerta. */
function closeAlertModal() {
Â  if (alertModal) alertModal.classList.remove('open');
}
window.closeAlertModal = closeAlertModal;

// --- LÃ“GICA DE COOLDOWN Y COMPARACIÃ“N (SIN CAMBIOS) ---

/** Revisa si el usuario debe esperar para tomar el quiz. */
function checkQuizCooldown() {
Â  const lastCompletionTimestamp = localStorage.getItem(LAST_QUIZ_KEY);
Â  if (!lastCompletionTimestamp) {
Â  Â  return true;
Â  }

Â  const lastCompletionDate = new Date(parseInt(lastCompletionTimestamp));
Â  const now = new Date();
Â  const differenceInMs = now - lastCompletionDate;
Â  const differenceInDays = differenceInMs / (1000 * 60 * 60 * 24);

Â  if (differenceInDays < COOLDOWN_DAYS) {
Â  Â  const daysLeft = Math.ceil(COOLDOWN_DAYS - differenceInDays);

Â  Â  if (quizCard && loadingEl) {
Â  Â  Â  quizCard.style.display = 'none';
Â  Â  Â  loadingEl.style.display = 'flex';
Â  Â  Â  loadingEl.innerHTML = `
Â  Â  Â  Â  Â  <div class="text-center p-8 bg-gray-800 rounded-xl shadow-2xl">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold text-yellow-400 mb-4">â³ Periodo de ReflexiÃ³n Activo â³</h2>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xl text-slate-300 mb-6">Debes esperar para volver a escanear tus habilidades.</p>
Â  Â  Â  Â  Â  Â  Â  <p class="text-lg text-slate-100">EstÃ¡s en un periodo de prÃ¡ctica para aplicar los consejos aprendidos.</p>
Â  Â  Â  Â  Â  Â  Â  <p class="text-2xl font-extrabold mt-4 text-emerald-400">${daysLeft} dÃ­as restantes.</p>
Â  Â  Â  Â  Â  Â  Â  <button onclick="window.location.href='home.html'" class="mt-8 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 rounded-lg text-white font-semibold transition-colors">Volver a la PÃ¡gina Principal</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }
Â  Â  return false;
Â  }

Â  return true;
}

/** Guarda el resultado actual en localStorage para la comparaciÃ³n futura. */
function saveResultsForComparison(results) {
Â  localStorage.setItem(LAST_QUIZ_KEY, new Date().getTime());
Â  const comparisonData = results.softSkills.map(s => ({
Â  Â  skill: s.skill,
Â  Â  score: s.score
Â  }));
Â  localStorage.setItem(PREVIOUS_RESULT_KEY, JSON.stringify(comparisonData));
}

/** Genera un objeto de comparaciÃ³n entre el resultado actual y el anterior. */
function getComparisonData(currentScores) {
Â  const previousResultJson = localStorage.getItem(PREVIOUS_RESULT_KEY);
Â  if (!previousResultJson) return {};

Â  try {
Â  Â  const previousScores = JSON.parse(previousResultJson);
Â  Â  const comparison = {};

Â  Â  previousScores.forEach(prev => {
Â  Â  Â  const current = currentScores.find(curr => curr.skill === prev.skill);
Â  Â  Â  if (current) {
Â  Â  Â  Â  const diff = current.score - prev.score;
Â  Â  Â  Â  comparison[prev.skill] = {
Â  Â  Â  Â  Â  diff: diff,
Â  Â  Â  Â  Â  arrow: diff > 0 ? 'â¬†ï¸' : (diff < 0 ? 'â¬‡ï¸' : 'â¡ï¸'),
Â  Â  Â  Â  Â  isChange: diff !== 0
Â  Â  Â  Â  };
Â  Â  Â  }
Â  Â  });
Â  Â  return comparison;

Â  } catch (e) {
Â  Â  console.error("Error al parsear el resultado anterior:", e);
Â  Â  return {};
Â  }
}

/** Reinicia el estado del quiz a su configuraciÃ³n inicial. */
function resetQuiz() {
    currentQuestionIndex = 0;
    for (const key in userAnswers) {
        delete userAnswers[key];
    }
    window.finalQuizResult = null;
    localStorage.removeItem('quiz_progress');
    
    if (resultCard) resultCard.style.display = 'none';
    if (quizCard) quizCard.style.display = 'block';
    
    if (saveResultBtn) {
        saveResultBtn.disabled = false;
        saveResultBtn.textContent = 'Guardar Resultado';
    }
    
    renderQuestion(currentQuestionIndex);
    updateProgressBar();
}

/** Carga el progreso del usuario desde localStorage. */
function loadProgress() {
    const savedAnswersJson = localStorage.getItem('quiz_progress');
    if (savedAnswersJson) {
        try {
            const savedAnswers = JSON.parse(savedAnswersJson);
            Object.assign(userAnswers, savedAnswers);

            const answeredIds = Object.keys(userAnswers);
            if (answeredIds.length > 0) {
                const lastQuestionId = answeredIds.reduce((a, b) => {
                    const idA = parseInt(a.slice(1) || 0);
                    const idB = parseInt(b.slice(1) || 0);
                    return idA > idB ? a : b;
                });
                
                const lastAnsweredQData = QUIZ_DATA.find(q => `q${q.id}` === lastQuestionId);
                
                if (lastAnsweredQData) {
                    let lastIndex = QUIZ_DATA.findIndex(q => q.id === lastAnsweredQData.id);
                    
                    if (answeredIds.length === QUIZ_DATA.length) {
                         currentQuestionIndex = QUIZ_DATA.length - 1;
                    } else if (lastIndex < QUIZ_DATA.length - 1) {
                        currentQuestionIndex = lastIndex + 1;
                    } else {
                        currentQuestionIndex = lastIndex;
                    }
                }
            }
        } catch (e) {
            console.error("Error al cargar el progreso:", e);
            localStorage.removeItem('quiz_progress');
        }
    }
}


// --- RENDERIZADO Y LÃ“GICA DE NAVEGACIÃ“N ---

/** Renderiza la pregunta actual en la interfaz. */
function renderQuestion(index) {
Â  if (!questionsContainer || !progressText || !progressBarFill) return;

Â  if (loadingEl) loadingEl.style.display = 'none';
Â  questionsContainer.innerHTML = '';
Â  const questionData = QUIZ_DATA[index];
Â  const questionNumber = index + 1;
Â  const originalQuestionId = `q${questionData.id}`;
Â  // Obtener las opciones de la escala correcta
Â  const scaleType = questionData.scaleType || DEFAULT_SCALE;
Â  const optionsMap = ANSWER_SCALES[scaleType].options;

Â  const questionHTML = `
Â  Â  Â  <div id="currentQuestion_${questionNumber}" class="question-item animate-in fade-in">
Â  Â  Â  Â  <p class="question-text">(${questionNumber}/${QUIZ_DATA.length}) ${questionData.text}</p>
Â  Â  Â  Â  <div class="options-group" data-q-original-id="${originalQuestionId}" data-q-index="${index}">
Â  Â  Â  Â  Â  ${optionsMap.map(option => {
Â  Â  Â  Â  Â  Â  const isSelected = userAnswers[originalQuestionId] === option;
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  class="option-btn ${isSelected ? 'selected' : ''}"
Â  Â  Â  Â  Â  Â  Â  Â  data-answer="${option}"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  ${option}
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  }).join('')}
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  `;
Â  questionsContainer.innerHTML = questionHTML;

Â  document.querySelectorAll('.option-btn').forEach(button => {
Â  Â  button.addEventListener('click', handleOptionClick);
Â  });

Â  updateNavigationButtons(originalQuestionId);
Â  updateProgressBar();
}

/** Maneja el clic en una opciÃ³n de respuesta. */
function handleOptionClick(event) {
Â  const button = event.target;
Â  const optionsGroup = button.closest('.options-group');
Â  if (!optionsGroup) return;

Â  const questionId = optionsGroup.dataset.qOriginalId;
Â  const answer = button.dataset.answer;

Â  optionsGroup.querySelectorAll('.option-btn').forEach(btn => {
Â  Â  btn.classList.remove('selected');
Â  });

Â  button.classList.add('selected');
Â  userAnswers[questionId] = answer;
Â  updateNavigationButtons(questionId);

Â  // --- Persistencia de Progreso ---
Â  localStorage.setItem('quiz_progress', JSON.stringify(userAnswers));
Â  // --------------------------------

Â  if (currentQuestionIndex < QUIZ_DATA.length - 1) {
Â  Â  setTimeout(() => {
Â  Â  Â  currentQuestionIndex++;
Â  Â  Â  renderQuestion(currentQuestionIndex);
Â  Â  }, 300);
Â  }
}

/** Actualiza la barra de progreso y el texto de estado. */
function updateProgressBar() {
Â  const answeredCount = Object.keys(userAnswers).length;
Â  const percentage = (answeredCount / QUIZ_DATA.length) * 100;
Â  if (progressBarFill) progressBarFill.style.width = `${percentage}%`;
Â  if (progressText) progressText.textContent = `PUNTO DE ESCANEO: ${currentQuestionIndex + 1} DE ${QUIZ_DATA.length}`;
}

/** Habilita/Deshabilita los botones de navegaciÃ³n segÃºn el estado. */
function updateNavigationButtons(questionId) {
Â  if (!prevBtn || !nextBtn || !submitBtn) return;

Â  const hasAnswer = !!userAnswers[questionId];
Â  prevBtn.style.display = currentQuestionIndex > 0 ? 'block' : 'none';

Â  if (hasAnswer) {
Â  Â  if (currentQuestionIndex < QUIZ_DATA.length - 1) {
Â  Â  Â  nextBtn.style.display = 'block';
Â  Â  Â  submitBtn.style.display = 'none';
Â  Â  } else {
Â  Â  Â  nextBtn.style.display = 'none';
Â  Â  Â  submitBtn.style.display = 'block';
Â  Â  }
Â  } else {
Â  Â  nextBtn.style.display = 'none';
Â  Â  submitBtn.style.display = 'none';
Â  }
}

// --- CÃLCULO DE RESULTADOS Y COMPARACIÃ“N ---

/** Determina el color de la barra de habilidad segÃºn el puntaje (0-100). */
function getBarColor(score) {
Â  if (score >= 80) return 'bg-emerald-500'; // Sobresaliente
Â  if (score >= 60) return 'bg-yellow-500'; // Competente
Â  if (score >= 40) return 'bg-orange-500'; // En desarrollo
Â  return 'bg-red-500'; // Necesita enfoque
}

/** Determina el color de borde lateral del item de habilidad. */
function getBorderColorClass(score) {
Â  if (score >= 80) return 'border-emerald-500';
Â  if (score >= 60) return 'border-yellow-500';
Â  if (score >= 40) return 'border-orange-500';
Â  return 'border-red-500';
}

/** Procesa las respuestas para calcular las mÃ©tricas finales. */
function calculateResults() {
Â  if (Object.keys(userAnswers).length !== QUIZ_DATA.length) {
Â  Â  showAlert('Faltan Respuestas', 'Por favor, asegÃºrate de responder todas las preguntas antes de finalizar.', true);
Â  Â  const answeredQuestionIds = Object.keys(userAnswers);
Â  Â  let firstUnansweredIndex = -1;

Â  Â  for (let i = 0; i < QUIZ_DATA.length; i++) {
Â  Â  Â  const qId = `q${QUIZ_DATA[i].id}`;
Â  Â  Â  if (!answeredQuestionIds.includes(qId)) {
Â  Â  Â  Â  firstUnansweredIndex = i;
Â  Â  Â  Â  break;
Â  Â  Â  }
Â  Â  }
Â  Â  if (firstUnansweredIndex !== -1) {
Â  Â  Â  currentQuestionIndex = firstUnansweredIndex;
Â  Â  Â  renderQuestion(currentQuestionIndex);
Â  Â  }
Â  Â  return;
Â  }

Â  const skillScores = {};
Â  const skillMinMax = {};
Â  const MAX_SCORE_PER_QUESTION_RAW = 5;

Â  // 1. Inicializar scores y min/max
Â  QUIZ_DATA.forEach(q => {
Â  Â  q.scores.forEach(s => {
Â  Â  Â  if (!skillScores[s.skill]) {
Â  Â  Â  Â  skillScores[s.skill] = 0;
Â  Â  Â  Â  skillMinMax[s.skill] = { min: 0, max: 0 };
Â  Â  Â  }
Â  Â  });
Â  });

Â  // 2. Calcular puntajes brutos y rangos
Â  QUIZ_DATA.forEach(q => {
Â  Â  const qId = `q${q.id}`;
Â  Â  const answerText = userAnswers[qId];
Â  Â  const scaleType = q.scaleType || DEFAULT_SCALE; // Obtener el tipo de escala
Â  Â  
Â  Â  // Obtener el valor numÃ©rico de la respuesta segÃºn la escala
Â  Â  const answerRawScore = ANSWER_SCALES[scaleType][answerText];
Â  Â  if (!answerRawScore) return;

Â  Â  q.scores.forEach(s => {
Â  Â  Â  const skill = s.skill;
Â  Â  Â  let score = s.polarity === 1
Â  Â  Â  Â  ? answerRawScore
Â  Â  Â  Â  : MAX_SCORE_PER_QUESTION_RAW + 1 - answerRawScore;

Â  Â  Â  skillScores[skill] += score;
Â  Â  Â  skillMinMax[skill].max += MAX_SCORE_PER_QUESTION_RAW;
Â  Â  Â  skillMinMax[skill].min += 1;
Â  Â  });
Â  });

Â  // 3. Normalizar puntajes a porcentaje (0-100)
Â  const finalScores = [];
Â  for (const skill in skillScores) {
Â  Â  const rawScore = skillScores[skill];
Â  Â  const minPossible = skillMinMax[skill].min;
Â  Â  const maxPossible = skillMinMax[skill].max;

Â  Â  const range = maxPossible - minPossible;
Â  Â  const normalizedScore = (rawScore - minPossible) / range;
Â  Â  const percentage = Math.round(normalizedScore * 100);

Â  Â  finalScores.push({ skill, score: percentage });
Â  }
Â  
Â  // 4. Determinar el perfil del usuario
Â  finalScores.sort((a, b) => b.score - a.score);
Â  const topSkills = finalScores.slice(0, 3).map(s => s.skill);
Â  let userProfile = PROFILES.find(p => p.skills.every(skill => topSkills.includes(skill)));

Â  if (!userProfile) {
Â  Â  userProfile = PROFILES.find(p => p.name === "EL DESARROLLADOR INTEGRAL");
Â  }

Â  // 5. Guardar resultado final
Â  window.finalQuizResult = {
Â  Â  answers: userAnswers,
Â  Â  softSkills: finalScores,
Â  Â  profile: userProfile.name,
Â  Â  date: new Date().toISOString().split('T')[0],
Â  Â  profileDescription: userProfile.description,
Â  };

Â  // 6. Renderizar y mostrar resultados
Â  renderResults(finalScores, userProfile);
}


/** Renderiza los resultados en la tarjeta de resultados con feedback detallado y comparaciÃ³n. */
function renderResults(scores, profile) {
Â  if (!quizCard || !resultCard || !profileNameEl || !profileDescriptionEl || !skillsList || !topSkillsPillsEl) return;

Â  quizCard.style.display = 'none';
Â  resultCard.style.display = 'block';

Â  profileNameEl.textContent = profile.name;
Â  profileDescriptionEl.textContent = profile.description;

Â  const comparisonData = getComparisonData(scores);
Â  saveResultsForComparison(window.finalQuizResult);
Â  localStorage.removeItem('quiz_progress');

Â  // 1. Renderizar Top Skills Pills
Â  topSkillsPillsEl.innerHTML = scores.slice(0, 3).map(s => `
Â  Â  <span class="bg-emerald-700 text-white text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">${s.skill}</span>
Â  `).join('');

Â  // 2. Renderizar lista de habilidades detallada
Â  skillsList.innerHTML = scores.map(s => {
Â  Â  const colorClass = getBarColor(s.score);
Â  Â  const borderClass = getBorderColorClass(s.score);
Â  Â  const feedback = SKILL_FEEDBACK[s.skill] || {};
Â  Â  const isHigh = s.score >= 60;
Â  Â  const qualitativeFeedback = isHigh ? feedback.high : feedback.low;
Â  Â Â 
Â  Â  // ComparaciÃ³n
Â  Â  const comp = comparisonData[s.skill];
Â  Â  const comparisonHTML = comp && comp.isChange 
Â  Â  Â  ? `<span class="ml-2 text-sm font-bold ${comp.diff > 0 ? 'text-emerald-300' : 'text-red-300'}">${comp.arrow} ${Math.abs(comp.diff)}%</span>`
Â  Â  Â  : '';

Â  Â  return `
Â  Â  Â  <div class="skill-item border-l-4 ${borderClass} p-4 mb-4 bg-slate-700/50 rounded-lg shadow-inner">
Â  Â  Â  Â  <div class="flex items-center justify-between mb-2">
Â  Â  Â  Â  Â  <span class="skill-name font-bold text-lg text-white">${s.skill}</span>
Â  Â  Â  Â  Â  <span class="ml-4 text-lg font-extrabold text-slate-300 flex items-center">${s.score}%${comparisonHTML}</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="skill-bar-container h-2 bg-slate-600 rounded-full mb-3">
Â  Â  Â  Â  Â  <div class="skill-bar ${colorClass} h-full rounded-full transition-all duration-1000 ease-out" style="width: ${s.score}%"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm mt-3 border-t border-slate-600 pt-2">
Â  Â  Â  Â  Â  <p class="font-semibold ${isHigh ? 'text-emerald-300' : 'text-orange-300'}">${isHigh ? 'Fortaleza:' : 'Debilidad Clave:'}</p>
Â  Â  Â  Â  Â  <p class="text-slate-200 ml-2">${isHigh ? qualitativeFeedback.strength : qualitativeFeedback.weakness}</p>
Â  Â  Â  Â  Â  <p class="font-semibold text-sky-400 mt-2">Consejo PrÃ¡ctico:</p>
Â  Â  Â  Â  Â  <p class="text-slate-200 ml-2">${qualitativeFeedback.tip}</p>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  `;
Â  }).join('');

Â  // Habilitar botÃ³n de guardar si el usuario estÃ¡ autenticado
Â  const token = localStorage.getItem('token');
Â  if (token && saveResultBtn) {
Â  Â  saveResultBtn.disabled = false;
Â  }
}


// --- GUARDAR RESULTADOS (Ruta a /api/quiz) ---

/** Guarda los resultados en la API con manejo robusto de errores de FastAPI */
async function saveResultsToAPI() {
Â  Â  const token = localStorage.getItem('token');
Â  Â  if (!token) {
Â  Â  Â  Â  showAlert('Acceso Denegado', 'Debes iniciar sesiÃ³n para guardar tus resultados.', true);
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (!window.finalQuizResult) {
Â  Â  Â  Â  showAlert('Error', 'No hay resultados que guardar.', true);
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // 1. Iniciar estado de carga
Â  Â  if (saveResultBtn) {
        saveResultBtn.disabled = true;
Â  Â  Â  Â  saveResultBtn.textContent = 'Guardando...';
    }

Â  Â  try {
Â  Â  Â  Â  const res = await fetch(`${API_URL}/api/quiz`, {Â 
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  'Authorization': `Bearer ${token}`,
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  body: JSON.stringify(window.finalQuizResult),
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (saveResultBtn) saveResultBtn.textContent = 'Guardar Resultado';
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (res.ok) {
Â  Â  Â  Â  Â  Â  showAlert('âœ… Ã‰xito', 'Tus resultados se han guardado correctamente en tu perfil. âœ…', false);
Â  Â  Â  Â  Â  Â  if (saveResultBtn) saveResultBtn.disabled = true;Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const data = await res.json().catch(() => ({}));
Â  Â  Â  Â  Â  Â  let errorMessage = '';

Â  Â  Â  Â  Â  Â  if (res.status === 404) {
Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = 'ğŸš¨ ERROR 404: La ruta /api/quiz no fue encontrada.';
Â  Â  Â  Â  Â  Â  } else if (res.status === 401 || res.status === 403) {
Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = 'Tu sesiÃ³n ha expirado o no estÃ¡s autorizado.';
Â  Â  Â  Â  Â  Â  } else if (data.detail && Array.isArray(data.detail)) {
Â  Â  Â  Â  Â  Â  Â  Â  // DiagnÃ³stico de error 422 (ValidaciÃ³n de FastAPI)
Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = 'ğŸš¨ Error de ValidaciÃ³n de Datos (422):\n\n';
Â  Â  Â  Â  Â  Â  Â  Â  data.detail.forEach(err => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const field = err.loc && err.loc.length > 1 ? err.loc[1] : 'Datos';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage += `â€¢ El campo "${field}" es invÃ¡lido: ${err.msg}\n`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = data.detail || `Error HTTP ${res.status}. Vuelve a intentarlo.`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  showAlert('âŒ Error al Guardar', errorMessage, true);
Â  Â  Â  Â  Â  Â  if (saveResultBtn) saveResultBtn.disabled = false;
Â  Â  Â  Â  }

Â  Â  } catch (error) {
Â  Â  Â  Â  if (saveResultBtn) {
            saveResultBtn.textContent = 'Guardar Resultado';
            saveResultBtn.disabled = false;
        }
Â  Â  Â  Â  showAlert('ğŸš¨ Error de ConexiÃ³n', 'No se pudo contactar con la API (Problema de red, servidor inactivo o timeout).', true);
Â  Â  }
}
Â  Â  Â Â 
// --- INICIALIZACIÃ“N Y EVENT LISTENERS (SIN CAMBIOS) ---

document.addEventListener('DOMContentLoaded', () => {
    if (!checkQuizCooldown()) {
        return;
    }
    
    loadProgress();
    renderQuestion(currentQuestionIndex);
    
    if (backBtn) backBtn.addEventListener('click', () => (window.location.href = 'home.html'));
    if (goHomeFromQuizBtn) goHomeFromQuizBtn.addEventListener('click', () => (window.location.href = 'home.html'));

    if (prevBtn) prevBtn.addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion(currentQuestionIndex);
      }
    });

    if (nextBtn) nextBtn.addEventListener('click', () => {
      const questionId = `q${QUIZ_DATA[currentQuestionIndex].id}`;
      if (userAnswers[questionId]) {
        currentQuestionIndex++;
        renderQuestion(currentQuestionIndex);
      }
    });

    if (submitBtn) submitBtn.addEventListener('click', calculateResults);
    if (saveResultBtn) saveResultBtn.addEventListener('click', saveResultsToAPI);
    
    const restartQuizBtn = document.getElementById('restartQuizBtn');
    if (restartQuizBtn) {
        restartQuizBtn.addEventListener('click', resetQuiz);
    }

    
    // --- LÃ³gica de la Tarjeta 3D (AnimaciÃ³n) ---
    const quizCardEl = document.querySelector('.quiz-card');

    if(quizCardEl) {
        quizCardEl.addEventListener('mousemove', (e) => {
            const card = e.currentTarget;
            const rect = card.getBoundingClientRect();

            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            const rotateX = ((y - centerY) / centerY) * 5;Â 
            const rotateY = ((x - centerX) / centerX) * 5;Â 
            
            card.style.transform = `rotateX(${-rotateX}deg) rotateY(${rotateY}deg) scale(1.01)`;
        });

        quizCardEl.addEventListener('mouseleave', () => {
            quizCardEl.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
            quizCardEl.style.transition = 'transform 0.6s cubic-bezier(.17,.67,.83,.67)';
        });

        quizCardEl.addEventListener('mouseenter', () => {
            quizCardEl.style.transition = 'none';
        });
    }
});
    </script>
  </body>
</html>








