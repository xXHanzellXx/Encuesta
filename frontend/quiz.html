<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SoftSkills360 - Test de Habilidades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
    /* ğŸ¨ CONFIGURACIÃ“N GLOBAL - ESTILO OSCURO ESMERALDA */
:root {
  --color-primary: #10b981; /* Esmeralda 500 */
  --color-accent: #059669; /* Esmeralda 600 */
  --color-bg-dark: #0f172a; /* Fondo oscuro */
  --color-card-dark: #1e293b; /* Fondo de tarjetas */
  --color-text-light: #f8fafc; /* Texto claro */
  --color-border: #475569; /* Borde neutro */
}

.quiz-container {
  perspective: 1200px; /* ğŸ”¹ MÃ¡s profundidad */
}

.quiz-card {
  transform-style: preserve-3d;
  transition: transform 0.3s ease;
  will-change: transform;
}

body {
  font-family: "Inter", sans-serif;
  background-color: var(--color-bg-dark);
  min-height: 100vh;
  color: var(--color-text-light);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow-y: auto;
  margin: 0;
}

/* ğŸ”¹ NAVBAR */
.navbar {
  background-color: rgba(15, 23, 42, 0.9);
  backdrop-filter: blur(6px);
  border-bottom: 2px solid var(--color-primary);
  padding: 0.6rem 1.2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 20;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
}

.navbar h1 {
  font-size: 1.3rem;
  font-weight: 900;
  color: var(--color-text-light);
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
}

/* ğŸ§© CONTENEDOR DEL QUIZ */
.quiz-container {
  max-width: 700px;
  margin: 5rem auto 2rem auto;
  padding: 1rem;
  position: relative;
  perspective: 1000px;
  transform: scale(0.95);
}

/* ğŸ’« TARJETA DEL QUIZ */
.quiz-card,
.result-card {
  background-color: var(--color-card-dark);
  border: 1px solid var(--color-border);
  border-radius: 1rem;
  padding: 1.8rem;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
  transition: all 0.5s ease, box-shadow 0.3s ease;
  animation: popCard 0.6s ease forwards;
}

.quiz-card:hover {
  transform: scale(1.01);
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
}

@keyframes popCard {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* ğŸ”¸ BARRA DE PROGRESO */
.progress-bar {
  width: 100%;
  height: 8px;
  background: #334155; /* gris azulado */
  border-radius: 9999px;
  margin-bottom: 1rem;
}

.progress-fill {
  background: var(--color-primary);
  height: 8px;
  width: 0%;
  border-radius: 9999px;
  box-shadow: 0 0 10px var(--color-primary);
  transition: width 0.6s ease-in-out;
}

/* â“ PREGUNTA */
.question-item {
  text-align: center;
}

.question-item p {
  font-size: 1.6rem;
  font-weight: 800;
  color: var(--color-text-light);
  margin-bottom: 1.2rem;
  text-shadow: 0 0 6px rgba(16, 185, 129, 0.4);
}

/* âš¡ OPCIONES */
.options-group {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.8rem;
  margin-top: 1rem;
}

.option-btn {
  background-color: #334155;
  border: 1px solid var(--color-border);
  color: var(--color-text-light);
  padding: 0.6rem 1.4rem;
  font-size: 1rem;
  font-weight: 700;
  border-radius: 0.6rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 120px;
  max-width: 220px;
  text-align: center;
}

.option-btn:hover {
  background-color: #475569;
  transform: scale(1.05);
  box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
}

.option-btn.selected {
  background: var(--color-primary);
  color: #0f172a;
  border: 2px solid white;
  font-weight: 900;
  transform: scale(1.08);
  box-shadow: 0 0 10px var(--color-primary);
}

/* ğŸ”» BOTONES DE ACCIÃ“N */
.quiz-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.cta-btn {
  background-color: var(--color-primary);
  color: #0f172a;
  font-weight: 900;
  padding: 0.7rem 1.6rem;
  border-radius: 0.6rem;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
  font-size: 0.95rem;
}

.cta-btn:hover {
  background-color: var(--color-accent);
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
}

.secondary-btn {
  background-color: #334155;
  color: var(--color-text-light);
  font-weight: 700;
  padding: 0.7rem 1.6rem;
  border-radius: 0.6rem;
  transition: all 0.3s ease;
  font-size: 0.95rem;
}

.secondary-btn:hover {
  background-color: #475569;
  transform: scale(1.03);
}

/* ğŸ’¬ RESULTADOS */
.result-card {
  text-align: center;
  padding: 1.8rem;
  margin-bottom: 2rem;
}

.result-card .text-emerald-500 {
  font-size: 1.8rem;
  font-weight: 900;
  color: var(--color-primary);
  text-shadow: 0 0 8px rgba(16, 185, 129, 0.7);
}

.result-card p {
  font-size: 1rem;
  color: #d1d5db;
}

.skill-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.4rem 0;
}

.skill-name {
  font-weight: 600;
  color: var(--color-text-light);
  width: 30%;
  text-align: left;
}

.skill-bar-container {
  flex-grow: 1;
  height: 8px;
  background-color: #334155;
  border-radius: 9999px;
  overflow: hidden;
}

.skill-bar {
  height: 100%;
  background-color: var(--color-primary);
  transition: width 0.5s ease-out;
  box-shadow: 0 0 4px rgba(16, 185, 129, 0.6);
}

/* Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 50;
  opacity: 0; /* Controlado por JS */
  visibility: hidden; /* Controlado por JS */
  transition: opacity 0.3s ease;
}

.modal-overlay.open {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background-color: var(--color-card-dark);
  padding: 1.5rem;
  border-radius: 1rem;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  max-width: 380px;
  text-align: center;
  border: 2px solid var(--color-primary);
}

.modal-content h3 {
  font-size: 1.3rem;
  font-weight: 800;
  color: var(--color-primary);
  margin-bottom: 0.8rem;
}

/* ğŸŒŸ EFECTO DE FONDO */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(
    circle at 50% 50%,
    rgba(16, 185, 129, 0.06) 0%,
    transparent 70%
  );
  z-index: -1;
}

/* ğŸ“± RESPONSIVIDAD */
@media (max-width: 640px) {
  .question-item p {
    font-size: 1.3rem;
  }

  .option-btn {
    width: 100%;
  }

  .quiz-card,
  .result-card {
    padding: 1.5rem;
  }

  .cta-btn,
  .secondary-btn {
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
  }
}
    </style>
  </head>
<body>
Â  Â  <header class="navbar">
Â  Â  Â  <h1>Habilidades Blandas</h1>
Â  Â  Â  <button id="backBtn" class="secondary-btn p-2 px-4">Volver</button>
Â  Â  </header>

Â  Â  <main class="quiz-container">
Â  Â  Â  <div id="quiz" class="quiz-card">
Â  Â  Â  Â  <h2 class="text-4xl font-extrabold text-center mb-8 text-white">
Â  Â  Â  Â  Â  INICIANDO ANÃLISIS DE HABILIDADES
Â  Â  Â  Â  </h2>

Â  Â  Â  Â  <div class="progress-bar">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  id="progressBarFill"
Â  Â  Â  Â  Â  Â  class="progress-fill"
Â  Â  Â  Â  Â  Â  style="width: 0%"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  id="questionsContainer"
Â  Â  Â  Â  Â  class="min-h-[250px] flex items-center justify-center"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div id="loading" class="text-gray-400 text-lg">
Â  Â  Â  Â  Â  Â  Cargando preguntas...
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="quiz-actions">
Â  Â  Â  Â  Â  <button id="prevBtn" class="secondary-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Anterior
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="nextBtn" class="cta-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Siguiente
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="submitBtn" class="cta-btn" style="display: none">
Â  Â  Â  Â  Â  Â  Finalizar Test
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="progress-footer text-center mt-4">
Â  Â  Â  Â  <p
Â  Â  Â  Â  Â  id="progressText"
Â  Â  Â  Â  Â  class="text-lg font-mono text-emerald-400 tracking-wider"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Cargando...
Â  Â  Â  Â  </p>
Â  Â  Â  </div>

Â  Â  Â  <div id="result" class="result-card" style="display: none">
Â  Â  Â  Â  <h3 class="text-4xl font-extrabold text-center mb-6 text-emerald-500">
Â  Â  Â  Â  ğŸš€ :: RESULTADOS FINALES :: ğŸš€
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div id="resultContent" class="text-gray-300">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="bg-gray-900/50 p-6 rounded-xl mb-8 border border-emerald-600/50"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <p class="text-lg font-medium mb-2 text-gray-400">
Â  Â  Â  Â  Â  Â  Â  PERFIL DETERMINADO:
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <h4
Â  Â  Â  Â  Â  Â  Â  id="profileName"
Â  Â  Â  Â  Â  Â  Â  class="text-3xl font-extrabold text-emerald-400"
Â  Â  Â  Â  Â  Â  ></h4>
Â  Â  Â  Â  Â  Â  <p id="profileDescription" class="mt-3 text-gray-400 italic"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="topSkillsPills" class="mt-4 flex flex-wrap gap-2"></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <h4
Â  Â  Â  Â  Â  Â  class="text-2xl font-bold mt-8 mb-4 border-b pb-2 border-slate-700/50 text-white"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  MÃ‰TRICAS DE HABILIDAD (0-100)
Â  Â  Â  Â  Â  </h4>
Â  Â  Â  Â  Â  <div id="skillsList" class="space-y-3">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="mt-10 text-center">
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="saveResultBtn"
Â  Â  Â  Â  Â  Â  class="cta-btn disabled:opacity-50"
Â  Â  Â  Â  Â  Â  disabled
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Guardar Resultado
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="goHomeFromQuiz" class="secondary-btn ml-4">
Â  Â  Â  Â  Â  Â  Volver al Inicio
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button 
Â  Â  Â  Â  Â  Â  id="restartQuizBtn" 
Â  Â  Â  Â  Â  Â  class="secondary-btn ml-4 bg-yellow-600 hover:bg-yellow-700 text-white"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Repetir Test
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="alertModal" class="modal-overlay">
Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h3 id="alertTitle">Â¡ALERTA DE SISTEMA!</h3>
Â  Â  Â  Â  <p id="alertMessage" class="text-gray-300">Mensaje de prueba.</p>
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  class="cta-btn bg-red-600 hover:bg-red-700 mt-6 text-white"
Â  Â  Â  Â  Â  onclick="closeAlertModal()"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ACEPTAR
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>

    <script>
   const API_URL = "https://encuestaa.onrender.com/"; 

// --- CONSTANTES Y CONFIGURACIÃ“N ---
const MAX_SCORE_PER_QUESTION_RAW = 5;
const COOLDOWN_DAYS = 7;
const LAST_QUIZ_KEY = 'lastQuizCompletion';
const PREVIOUS_RESULT_KEY = 'previousQuizResult';

// Escalas de respuesta (Contextualizadas)
const ANSWER_SCALES = {
    'attitude': {
        options: ["Totalmente en desacuerdo", "En desacuerdo", "Neutral/Depende", "De acuerdo", "Totalmente de acuerdo"]
    },
    'frequency': {
        options: ["Nunca / Casi nunca", "Raramente", "A veces", "Frecuentemente", "Siempre / Casi siempre"]
    }
};
const DEFAULT_SCALE = 'frequency';

// --- 40 PREGUNTAS MULTIFACTORIALES (Escaneo Profundo) ---
const QUIZ_DATA = [
    { id: 1, text: "Al inicio de un proyecto, Â¿dedicas mÃ¡s tiempo a la planificaciÃ³n detallada (milestones, dependencias) que a la ejecuciÃ³n inmediata?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 2, text: "Si un requisito clave de un cliente cambia a Ãºltima hora, Â¿te frustras visiblemente o lo ves como una oportunidad para demostrar flexibilidad?", scores: [{ skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'attitude' },
    { id: 3, text: "En una reuniÃ³n de ideas, Â¿sientes que es tu deber seÃ±alar los defectos de una idea 'loca' inmediatamente en lugar de intentar mejorarla primero?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: -1 }], scaleType: 'attitude' },
    { id: 4, text: "Â¿Buscas tomar todas las decisiones importantes del equipo para asegurar que se hagan 'bien', restando autonomÃ­a a tus compaÃ±eros?", scores: [{ skill: "Liderazgo", polarity: -1 }, { skill: "Trabajo en equipo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'frequency' },
    { id: 5, text: "Cuando un colega te pide ayuda, Â¿le interrumpes para ofrecerle la soluciÃ³n apenas crees entender la causa, sin dejar que termine?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }], scaleType: 'frequency' },
    { id: 6, text: "Â¿Realizas o exploras una nueva herramienta o curso por iniciativa propia, incluso si no tiene una aplicaciÃ³n directa en tu trabajo actual?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Creatividad e innovaciÃ³n", polarity: 1 }], scaleType: 'frequency' },
    { id: 7, text: "Si fallas un plazo importante, Â¿te cuesta dÃ­as recuperarte emocionalmente y volver a concentrarte plenamente en otras tareas?", scores: [{ skill: "Resiliencia", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }], scaleType: 'attitude' },
    { id: 8, text: "En un debate intenso, Â¿priorizas alcanzar un acuerdo que satisfaga a todos sobre imponer tu punto de vista, aunque este sea lÃ³gicamente superior?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }], scaleType: 'attitude' },
    { id: 9, text: "Â¿Te sientes ansioso o molesto cuando un software o proceso que dominas es reemplazado por uno nuevo sin previo aviso?", scores: [{ skill: "Adaptabilidad al cambio", polarity: -1 }, { skill: "Aprendizaje continuo", polarity: -1 }, { skill: "Resiliencia", polarity: -1 }], scaleType: 'attitude' },
    { id: 10, text: "Â¿Eres de los que prefiere 'pedir perdÃ³n antes que permiso' cuando ves una oportunidad clara de mejora o eficiencia?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'attitude' },
    { id: 11, text: "Â¿Ante un problema conocido, revisas primero si existe una soluciÃ³n estÃ¡ndar antes de intentar crear una nueva desde cero?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: -1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 12, text: "Â¿Crees que los problemas personales de un empleado son irrelevantes y no deberÃ­an afectar la planificaciÃ³n del equipo bajo ninguna circunstancia?", scores: [{ skill: "Liderazgo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'attitude' },
    { id: 13, text: "Â¿Simplificas intencionalmente los detalles tÃ©cnicos complejos cuando hablas con personas no tÃ©cnicas, aunque se pierda precisiÃ³n?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }], scaleType: 'frequency' },
    { id: 14, text: "Cuando el equipo atraviesa una crisis, Â¿logras mantener la moral alta y el enfoque positivo en la soluciÃ³n?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'frequency' },
    { id: 15, text: "Â¿Sueles trabajar en una sola tarea importante a la vez (Deep Work) evitando saltar entre varias tareas pequeÃ±as?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: -1 }], scaleType: 'frequency' },
    { id: 16, text: "Â¿Buscas activamente tutoriales o documentaciÃ³n avanzada sobre un tema, incluso si ya puedes resolver las tareas bÃ¡sicas con lo que sabes?", scores: [{ skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 17, text: "Â¿Modificas tu estilo de comunicaciÃ³n (tono, formalidad) segÃºn la personalidad de la persona con la que interactÃºas?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }], scaleType: 'frequency' },
    { id: 18, text: "Â¿Te sientes responsable del crecimiento profesional de tus compaÃ±eros, incluso si no eres su jefe directo?", scores: [{ skill: "Liderazgo", polarity: 1 }, { skill: "Proactividad", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }], scaleType: 'attitude' },
    { id: 19, text: "Â¿Evitas dar feedback negativo directo a un colega para preservar una relaciÃ³n armoniosa?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: -1 }, { skill: "Trabajo en equipo", polarity: -1 }, { skill: "EmpatÃ­a", polarity: -1 }], scaleType: 'frequency' },
    { id: 20, text: "Cuando tienes una idea muy innovadora, Â¿el miedo al fracaso te detiene de compartirla?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: -1 }, { skill: "Resiliencia", polarity: -1 }], scaleType: 'attitude' },
    { id: 21, text: "Â¿Utilizas una lista de 'no hacer' o bloqueadores de sitios web para evitar distracciones?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: 1 }, { skill: "Proactividad", polarity: 1 }], scaleType: 'frequency' },
    { id: 22, text: "Â¿Consideras que el Ã©xito de un proyecto es mÃ©rito del equipo y no solo de tu esfuerzo individual?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'attitude' },
    { id: 23, text: "Â¿Buscas datos y mÃ©tricas para validar tus suposiciones, incluso si tu intuiciÃ³n ya te dice cuÃ¡l es la respuesta?", scores: [{ skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }, { skill: "Aprendizaje continuo", polarity: 1 }], scaleType: 'frequency' },
    { id: 24, text: "Â¿Eres el primero en el equipo en experimentar con nuevas herramientas, a pesar de los posibles errores iniciales?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Trabajo en equipo", polarity: -1 }], scaleType: 'frequency' },
    { id: 25, text: "Â¿Cuando un colega habla, centras tu atenciÃ³n en lo que dice y no en lo que vas a responder a continuaciÃ³n?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }], scaleType: 'frequency' },
    { id: 26, text: "Â¿Tienes estrategias definidas (ej. respiraciÃ³n, pausas) para manejar picos de estrÃ©s?", scores: [{ skill: "Resiliencia", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'frequency' },
    { id: 27, text: "Â¿Utilizas analogÃ­as de otros campos (arte, biologÃ­a) para resolver problemas tÃ©cnicos?", scores: [{ skill: "Creatividad e innovaciÃ³n", polarity: 1 }, { skill: "Adaptabilidad al cambio", polarity: 1 }], scaleType: 'frequency' },
    { id: 28, text: "Â¿Te aseguras de que todos los stakeholders entiendan las implicaciones antes de proceder?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }], scaleType: 'frequency' },
    { id: 29, text: "Si el equipo falla, Â¿asumes tu parte de la responsabilidad pÃºblicamente?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "Resiliencia", polarity: 1 }], scaleType: 'frequency' },
    { id: 30, text: "Â¿Necesitas que un colega te cuestione para encontrar los puntos dÃ©biles de tu diseÃ±o?", scores: [{ skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: -1 }, { skill: "Proactividad", polarity: -1 }], scaleType: 'frequency' },
    { id: 31, text: "Â¿Sientes que pierdes tiempo si pasas un dÃ­a aprendiendo sin producir cÃ³digo?", scores: [{ skill: "GestiÃ³n del tiempo", polarity: -1 }, { skill: "Aprendizaje continuo", polarity: -1 }], scaleType: 'attitude' },
    { id: 32, text: "Â¿Delegas tareas complejas para fomentar el crecimiento de otros?", scores: [{ skill: "Liderazgo", polarity: 1 }, { skill: "Trabajo en equipo", polarity: 1 }], scaleType: 'frequency' },
    { id: 33, text: "Â¿Puedes resumir con precisiÃ³n la posiciÃ³n de otra persona antes de refutarla?", scores: [{ skill: "EmpatÃ­a", polarity: 1 }, { skill: "ComunicaciÃ³n efectiva", polarity: 1 }], scaleType: 'frequency' },
    { id: 34, text: "Â¿Te aburre trabajar siempre con la misma tecnologÃ­a o tipo de proyecto?", scores: [{ skill: "Adaptabilidad al cambio", polarity: 1 }, { skill: "Creatividad e innovaciÃ³n", polarity: 1 }], scaleType: 'attitude' },
    { id: 35, text: "Â¿Automatizas tareas manuales aunque te tome mÃ¡s tiempo al principio?", scores: [{ skill: "Proactividad", polarity: 1 }, { skill: "GestiÃ³n del tiempo", polarity: 1 }], scaleType: 'frequency' },
    { id: 36, text: "Tras un error, Â¿analizas pasos concretos para prevenir que vuelva a ocurrir?", scores: [{ skill: "Resiliencia", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 37, text: "Â¿Documentas y compartes tus nuevos aprendizajes con el equipo?", scores: [{ skill: "Aprendizaje continuo", polarity: 1 }, { skill: "Liderazgo", polarity: 1 }, { skill: "Trabajo en equipo", polarity: 1 }], scaleType: 'frequency' },
    { id: 38, text: "Â¿Ofreces ayuda a compaÃ±eros que luchan con una tarea sin que te la pidan?", scores: [{ skill: "Trabajo en equipo", polarity: 1 }, { skill: "EmpatÃ­a", polarity: 1 }, { skill: "Proactividad", polarity: 1 }], scaleType: 'frequency' },
    { id: 39, text: "Â¿Revisas tus mensajes importantes dos veces para eliminar ambigÃ¼edades?", scores: [{ skill: "ComunicaciÃ³n efectiva", polarity: 1 }, { skill: "Pensamiento crÃ­tico y resoluciÃ³n de problemas", polarity: 1 }], scaleType: 'frequency' },
    { id: 40, text: "Â¿Te molesta profundamente cuando tu rutina se interrumpe por emergencias?", scores: [{ skill: "Adaptabilidad al cambio", polarity: -1 }, { skill: "GestiÃ³n del tiempo", polarity: -1 }, { skill: "Resiliencia", polarity: -1 }], scaleType: 'attitude' }
];

// --- DATA EXTENSA DE PERFILES ---
const PROFILES = [
    { 
        name: "EL ARQUITECTO ESTRATÃ‰GICO", 
        skills: ["Liderazgo", "Pensamiento crÃ­tico y resoluciÃ³n de problemas", "ComunicaciÃ³n efectiva"], 
        description: "Usted posee la rara habilidad de ver el tablero de ajedrez completo. No solo resuelve problemas; diseÃ±a los sistemas que evitan que los problemas ocurran. Su liderazgo no se basa en la autoridad, sino en la claridad de pensamiento. Es el perfil ideal para roles de CTO, Arquitectura de Software o DirecciÃ³n de Producto, donde la visiÃ³n a largo plazo y la comunicaciÃ³n precisa son vitales." 
    },
    { 
        name: "EL CONECTOR HUMANO Y TÃ‰CNICO", 
        skills: ["Trabajo en equipo", "EmpatÃ­a", "ComunicaciÃ³n efectiva"], 
        description: "Usted es el 'pegamento' indispensable de cualquier organizaciÃ³n. En un mundo de cÃ³digo y mÃ¡quinas, usted domina el algoritmo mÃ¡s complejo: las personas. Su capacidad para leer el ambiente, mediar en conflictos invisibles y articular ideas complejas de forma simple lo convierte en un lÃ­der de cultura. Sin usted, los equipos se fragmentan y los proyectos se estancan por fricciÃ³n humana." 
    },
    { 
        name: "EL AGENTE DE EVOLUCIÃ“N ÃGIL", 
        skills: ["Adaptabilidad al cambio", "Resiliencia", "Aprendizaje continuo"], 
        description: "Usted es la definiciÃ³n de 'AntifrÃ¡gil'. Mientras otros temen el cambio de requisitos o tecnologÃ­a, usted lo utiliza como combustible. Su perfil indica una mentalidad de crecimiento inquebrantable. Es el activo mÃ¡s valioso en Startups, entornos de innovaciÃ³n rÃ¡pida o durante fusiones corporativas, donde la Ãºnica constante es el caos y la necesidad de aprender ayer lo que se necesita hoy." 
    },
    { 
        name: "EL VISIONARIO DISRUPTIVO", 
        skills: ["Creatividad e innovaciÃ³n", "Proactividad", "Pensamiento crÃ­tico y resoluciÃ³n de problemas"], 
        description: "Usted no sigue caminos; los abre. Su mente rechaza instintivamente el 'status quo'. Donde otros ven un proceso establecido, usted ve ineficiencia esperando ser optimizada. Su combinaciÃ³n de creatividad con la iniciativa para ejecutar (Proactividad) lo hace peligroso (en el buen sentido) para la competencia. Es el motor de I+D y diferenciaciÃ³n de su empresa." 
    },
    { 
        name: "EL MAESTRO DE LA EJECUCIÃ“N", 
        skills: ["GestiÃ³n del tiempo", "Proactividad", "Resiliencia"], 
        description: "Usted convierte estrategias abstractas en resultados tangibles. Su disciplina es su superpoder. No se distrae, no pone excusas y se recupera de los fallos con una velocidad asombrosa. En un mundo lleno de 'iniciadores', usted es un 'finalizador'. Los equipos de alto rendimiento se construyen alrededor de personas como usted que garantizan que el trabajo se haga, a tiempo y con calidad." 
    },
    { 
        name: "EL PROFESIONAL INTEGRAL (360Â°)", 
        skills: [], 
        description: "Su perfil es un polÃ­gono perfecto. Ha logrado un equilibrio que pocos alcanzan, evitando las debilidades crÃ­ticas que suelen descarrilar carreras. Es el comodÃ­n definitivo, capaz de liderar, ejecutar o mediar segÃºn la situaciÃ³n lo requiera. Su desafÃ­o ahora es la especializaciÃ³n: elija quÃ© 'pico' quiere desarrollar para destacar aÃºn mÃ¡s sobre su sÃ³lida base." 
    },
];

// --- FEEDBACK DETALLADO (Nivel ConsultorÃ­a) ---
const SKILL_FEEDBACK = {
    "Liderazgo": {
        low: { 
            title: "Liderazgo Pasivo / Reactivo",
            weakness: "Actualmente, su estilo de trabajo sugiere una evitaciÃ³n de la responsabilidad de 'dirigir'. Puede que estÃ© esperando permiso para actuar o evitando conversaciones difÃ­ciles. Esto crea un vacÃ­o de poder que genera incertidumbre en sus pares.", 
            tip: "Adopte la **'Propiedad Extrema'**. No necesita un cargo para liderar. MaÃ±ana, identifique una tarea que nadie quiere hacer, hÃ¡gase dueÃ±o de ella y llÃ©vela a tÃ©rmino. El liderazgo comienza con la responsabilidad personal, no con la autoridad." 
        },
        high: { 
            title: "Liderazgo Transformacional",
            strength: "Usted inspira acciÃ³n. Su enfoque va mÃ¡s allÃ¡ de gestionar tareas; gestiona personas y visiones. Tiene la capacidad de elevar el estÃ¡ndar de quienes le rodean.", 
            tip: "Su siguiente nivel es la **MentorÃ­a Escalable**. Deje de sumar seguidores y empiece a crear lÃ­deres. Identifique a su reemplazo y comience a entrenarlo hoy mismo." 
        },
    },
    "ComunicaciÃ³n efectiva": {
        low: { 
            title: "ComunicaciÃ³n Ambigua / Unidireccional",
            weakness: "Existe una brecha entre lo que piensa y lo que los demÃ¡s entienden. Es probable que asuma que los demÃ¡s tienen su contexto, lo que lleva a errores costosos y retrabajos.", 
            tip: "Utilice la tÃ©cnica **ELI5 (ExplÃ­came como si tuviera 5 aÃ±os)** para conceptos tÃ©cnicos. Antes de enviar un correo importante, lÃ©alo en voz alta. Si se traba al leerlo, su lector se trabarÃ¡ al entenderlo." 
        },
        high: { 
            title: "Articulador Maestro",
            strength: "Usted convierte la complejidad en claridad. Es el traductor universal entre el negocio y la tecnologÃ­a, eliminando fricciones y alineando equipos dispares.", 
            tip: "Documente su conocimiento. Su capacidad verbal es efÃ­mera; su capacidad escrita es eterna. Cree guÃ­as, wikis o blogs internos para escalar su claridad." 
        },
    },
    "Trabajo en equipo": {
        low: { 
            title: "Contribuidor Individual Aislado",
            weakness: "Tiende a optimizar su propio rendimiento a expensas del flujo del equipo. Puede que retenga informaciÃ³n o vea la colaboraciÃ³n como una interrupciÃ³n a 'su' trabajo.", 
            tip: "Cambie su mÃ©trica de Ã©xito. Deje de medir 'mis tareas completadas' y mida 'tareas del equipo desbloqueadas'. Pregunte diariamente: 'Â¿A quiÃ©n puedo desbloquear hoy?'." 
        },
        high: { 
            title: "Multiplicador de Sinergia",
            strength: "Usted entiende que 1+1=3. Su presencia hace que los demÃ¡s sean mejores. Es experto en crear seguridad psicolÃ³gica, permitiendo que el equipo innove sin miedo.", 
            tip: "Proteja la cultura. Usted es el guardiÃ¡n de los valores del equipo. Cuando vea un comportamiento tÃ³xico, tiene el capital social para corregirlo con empatÃ­a." 
        },
    },
    "Adaptabilidad al cambio": {
        low: { 
            title: "Resistencia EstÃ¡tica",
            weakness: "El cambio le genera fricciÃ³n. Se aferra a herramientas o procesos obsoletos por comodidad, lo que lo pone en riesgo de irrelevancia tÃ©cnica.", 
            tip: "Hackee su cerebro: Cambie algo pequeÃ±o intencionalmente cada semana (su editor de texto, su ruta al trabajo, su horario). Entrene el mÃºsculo de la incomodidad." 
        },
        high: { 
            title: "Fluidez DinÃ¡mica",
            strength: "El caos no lo paraliza; lo activa. Usted navega la incertidumbre con gracia y ve las crisis como oportunidades para reescribir las reglas del juego.", 
            tip: "Sea el 'Early Adopter' del equipo. Pruebe las tecnologÃ­as beta y filtre lo Ãºtil para los demÃ¡s, ahorrÃ¡ndoles la curva de aprendizaje." 
        },
    },
    "Resiliencia": {
        low: { 
            title: "Fragilidad ante el Fracaso",
            weakness: "Los errores se internalizan como fallos personales. Esto lleva a una aversiÃ³n al riesgo y a una recuperaciÃ³n lenta tras crÃ­ticas o bugs importantes.", 
            tip: "Separe su **Identidad** de su **Resultado**. Usted no es su cÃ³digo. Un bug es un dato, no una sentencia. Practique el 'Post-Mortem sin culpa' con usted mismo." 
        },
        high: { 
            title: "Antifragilidad",
            strength: "Usted se beneficia del estrÃ©s. No solo rebota tras un golpe, sino que vuelve mÃ¡s fuerte y sabio. Su estabilidad emocional es un ancla para el equipo.", 
            tip: "Comparta sus fracasos. Al hablar abiertamente de sus errores pasados, autoriza a los demÃ¡s a tomar riesgos y aprender, eliminando el miedo al error en el equipo." 
        },
    },
    "Pensamiento crÃ­tico y resoluciÃ³n de problemas": {
        low: { 
            title: "Pensamiento Superficial / Intuitivo",
            weakness: "Acepta la primera soluciÃ³n que viene a la mente. Falta rigor en el anÃ¡lisis de causa raÃ­z, lo que lleva a solucionar sÃ­ntomas y no enfermedades.", 
            tip: "OblÃ­guese a escribir 3 posibles soluciones antes de elegir una. Use los **'5 PorquÃ©s'** en cada problema para taladrar hasta la verdad fundamental." 
        },
        high: { 
            title: "Pensamiento de Primeros Principios",
            strength: "Usted deconstruye la realidad. No acepta 'las cosas son asÃ­'. Su capacidad para razonar desde cero le permite encontrar soluciones elegantes a problemas imposibles.", 
            tip: "Afronte los problemas sistÃ©micos. Deje de apagar fuegos y diseÃ±e sistemas a prueba de incendios. Su mente debe estar en la arquitectura, no en la albaÃ±ilerÃ­a." 
        },
    },
    "Creatividad e innovaciÃ³n": {
        low: { 
            title: "EjecuciÃ³n Convencional",
            weakness: "Preferencia excesiva por lo seguro y probado. Si bien es eficiente, corre el riesgo de estancarse mientras el mercado innova a su alrededor.", 
            tip: "Practique la **'PolinizaciÃ³n Cruzada'**. Lea libros de industrias ajenas a la suya. La innovaciÃ³n suele ser simplemente aplicar una soluciÃ³n vieja a un contexto nuevo." 
        },
        high: { 
            title: "Motor de InnovaciÃ³n",
            strength: "Su mente es una fÃ¡brica de 'Â¿Y si...?'. Ve conexiones donde otros ven ruido. Su valor radica en generar la ventaja competitiva del futuro.", 
            tip: "Aprenda a vender sus ideas. La mejor idea del mundo muere si no sabe comunicarle su ROI (Retorno de InversiÃ³n) a los tomadores de decisiones." 
        },
    },
    "GestiÃ³n del tiempo": {
        low: { 
            title: "Reactividad CrÃ³nica",
            weakness: "Su agenda es dictada por el email y las interrupciones de otros. EstÃ¡ 'ocupado', pero no es 'productivo'. Confunde movimiento con avance.", 
            tip: "Defina su **M.I.T. (Most Important Task)** cada maÃ±ana. No abra el correo hasta haber trabajado 90 minutos en ella. Defienda su tiempo como si fuera dinero." 
        },
        high: { 
            title: "MaestrÃ­a del Flujo (Flow)",
            strength: "Usted controla el tiempo, no al revÃ©s. Su capacidad para el trabajo profundo (Deep Work) le permite producir en horas lo que a otros les toma dÃ­as.", 
            tip: "Optimice su entorno. Automatice decisiones triviales (ropa, comida) para reservar su energÃ­a mental para los problemas mÃ¡s complejos del proyecto." 
        },
    },
    "Proactividad": {
        low: { 
            title: "Ejecutor Pasivo",
            weakness: "Espera instrucciones. Si ve un problema que no es 'su trabajo', lo ignora. Esto limita su crecimiento a lo que otros deciden por usted.", 
            tip: "Adopte la mentalidad de **DueÃ±o**. Si ve basura en el suelo (cÃ³digo sucio, proceso roto), recÃ³jala. La iniciativa es el predictor #1 de ascenso profesional." 
        },
        high: { 
            title: "Catalizador de AcciÃ³n",
            strength: "Usted hace que las cosas sucedan. Anticipa necesidades futuras y actÃºa hoy. No necesita permiso para mejorar su entorno.", 
            tip: "Alinee su iniciativa con la estrategia del negocio. AsegÃºrese de que los fuegos que apaga son los que realmente importan a la organizaciÃ³n." 
        },
    },
    "EmpatÃ­a": {
        low: { 
            title: "Ceguera Emocional",
            weakness: "Se enfoca tanto en la lÃ³gica que atropella los sentimientos de los demÃ¡s. Puede ser percibido como frÃ­o o abrasivo, lo que reduce la cooperaciÃ³n.", 
            tip: "Antes de criticar, valide. Use la frase: **'Veo que esto es importante para ti...'**. La gente no le importa cuÃ¡nto sabe hasta que saben cuÃ¡nto le importa." 
        },
        high: { 
            title: "Resonancia Emocional",
            strength: "Lee el salÃ³n al instante. Entiende las motivaciones ocultas de las personas y sabe cÃ³mo comunicarse para obtener lo mejor de cada uno.", 
            tip: "Use su don para la negociaciÃ³n. Usted puede resolver conflictos enquistados encontrando el 'tercer camino' que satisface las necesidades emocionales de ambas partes." 
        },
    },
    "Aprendizaje continuo": {
        low: { 
            title: "Estancamiento de Habilidades",
            weakness: "Se conforma con lo que ya sabe. En tecnologÃ­a, si no estÃ¡ avanzando, estÃ¡ retrocediendo. Corre riesgo de obsolescencia profesional.", 
            tip: "Aplique la **Regla de las 5 Horas**: Dedique una hora diaria (o 5 semanales) a aprender deliberadamente. Vea el aprendizaje como parte de su trabajo, no como un extra." 
        },
        high: { 
            title: "MÃ¡quina de Aprendizaje (Polymath)",
            strength: "Su curiosidad es voraz. Aprende rÃ¡pido, desaprende rÃ¡pido y conecta conceptos dispares. Usted es el seguro de vida de la empresa ante el futuro.", 
            tip: "EnseÃ±e para aprender. La mejor forma de consolidar un conocimiento complejo es explicÃ¡rselo a los demÃ¡s. Inicie 'Brown Bag Sessions' en su equipo." 
        },
    },
};

// Reemplaza toda la funciÃ³n calculateResults en tu quiz.html
// Reemplaza toda la funciÃ³n calculateResults en tu quiz.html
function calculateResults() {
    // ğŸš¨ VALIDACIÃ“N FINAL: Asegurarse de que todas las preguntas estÃ¡n respondidas
    if (Object.keys(userAnswers).length !== QUIZ_DATA.length) {
        // Asumiendo que showAlertModal es la implementaciÃ³n actual de 'showAlert'
        showAlertModal('Faltan Respuestas', 'Por favor, asegÃºrate de responder todas las preguntas antes de finalizar.', true);
        for (let i = 0; i < QUIZ_DATA.length; i++) {
            const qId = `q${i + 1}`;
            // userAnswers es un array, no un objeto, asÃ­ que se usa el Ã­ndice 'i'.
            // Corregido: Si la respuesta en el Ã­ndice 'i' es nula o indefinida, navegamos.
            if (userAnswers[i] == null) {
                currentQuestionIndex = i;
                renderQuestion(currentQuestionIndex);
                break;
            }
        }
        return;
    }

    const skillScores = {};
    const skillCounts = {};
    const MAX_SCORE_PER_QUESTION = 4; // Puntaje mÃ¡ximo por pregunta (asumiendo escala 0-4)

    // 1. Recolectar puntajes brutos por habilidad y construir el objeto 'answers' para el API
    const answersForApi = {}; 

    QUIZ_DATA.forEach((q, index) => { // AÃ±adido 'index' para acceder a userAnswers[index]
        const qId = `q${q.id}`;
        // userAnswers es un array numÃ©rico [1, 5, 3...], no un Dict de 'answerText'
        const scoreValue = userAnswers[index] - 1; // Convertir valor (1-5) a score (0-4)
        const skill = q.skill;

        // **NOTA:** Esta versiÃ³n de cÃ¡lculo SÃ“LO funciona si QUIZ_DATA
        // tiene un campo 'skill' simple y no usa la estructura 'scores' con 'polarity'.
        // Si usas 'scores', la lÃ³gica de 'submitQuiz' es la correcta.
        // Asumo que esta versiÃ³n mÃ¡s simple es intencional o una versiÃ³n antigua.
        
        if (!skillScores[skill]) {
            skillScores[skill] = 0;
            skillCounts[skill] = 0;
        }
        
        skillScores[skill] += scoreValue;
        skillCounts[skill]++;

        // ğŸŸ¢ Guardamos el valor numÃ©rico (scoreValue + 1 para obtener 1-5) COMO STRING para el API
        answersForApi[`q${q.id}`] = (scoreValue + 1).toString();
    });

    // 2. Calcular porcentajes (0-100) y el resto del cÃ³digo es idÃ©ntico y correcto.
    const finalScores = [];
    let maxPossibleScore = 0;

    for (const skill in skillScores) {
        maxPossibleScore = skillCounts[skill] * MAX_SCORE_PER_QUESTION;
        const percentage = Math.round((skillScores[skill] / maxPossibleScore) * 100);
        finalScores.push({ skill, score: percentage });
    }
    
    // 3. Determinar el perfil del usuario (LÃ³gica idÃ©ntica y correcta)
    finalScores.sort((a, b) => b.score - a.score);
    const topSkills = finalScores.slice(0, 3).map(s => s.skill);
    let userProfile = PROFILES.find(p => p.skills.filter(skill => topSkills.includes(skill)).length >= 2);

    if (!userProfile) {
        userProfile = PROFILES.find(p => p.name === "EL DESARROLLADOR INTEGRAL");
    }
    
    // 4. Guardar resultado final con la estructura COMPLETA esperada por el backend (idÃ©ntica y correcta)
    window.finalQuizResult = {
        answers: answersForApi, // Dict[str, str] (q1: "4", q2: "2", etc.)
        softSkills: finalScores.map(s => ({ skill: s.skill, score: s.score })), // List[{skill: str, score: int}]
        profile: userProfile.name, // str
        date: new Date().toISOString().split('T')[0], // str (YYYY-MM-DD)
        profileDescription: userProfile.description // str
    };

    // 5. Renderizar y mostrar resultados
    // AsegÃºrate de que tienes una funciÃ³n 'renderResults' o usa 'renderResultsView'
    renderResultsView(finalScores, userProfile); 
}
Â  Â  Â Â 
// --- VARIABLES GLOBALES ---
let currentQuestionIndex = 0;
let userAnswers = [];
let quizResults = null;

// --- ELEMENTOS DOM ---
let quizEl, resultEl, questionsContainer, progressBarFill, progressText, prevBtn, nextBtn, submitBtn, alertModal, alertTitle, alertMessage, quizCardEl, goHomeFromQuiz, restartQuizBtn, topSkillsPillsEl, skillsList, profileNameEl, profileDescriptionEl, saveResultBtn;

// --- UTILIDADES ---
function shuffleArray(array) {
Â  Â  for (let i = array.length - 1; i > 0; i--) {
Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  Â  Â  [array[i], array[j]] = [array[j], array[i]];
Â  Â  }
}

function showAlertModal(title, message, isError = true) {
Â  Â  if (!alertModal) return;
Â  Â  alertTitle.textContent = title;
Â  Â  alertMessage.textContent = message;
Â  Â  const ctaBtn = alertModal.querySelector('.cta-btn');
Â  Â  if (ctaBtn) {
Â  Â  Â  Â  ctaBtn.className = isErrorÂ 
Â  Â  Â  Â  Â  Â  ? 'cta-btn mt-6 text-white w-full py-2 rounded bg-red-600 hover:bg-red-700'Â 
Â  Â  Â  Â  Â  Â  : 'cta-btn mt-6 text-white w-full py-2 rounded bg-emerald-600 hover:bg-emerald-700';
Â  Â  }
Â  Â  alertModal.classList.add('open');
}

window.closeAlertModal = function() {
Â  Â  if (alertModal) alertModal.classList.remove('open');
}

// --- LÃ“GICA DE COOLDOWN Y COMPARACIÃ“N (ACTUALIZADA A ASYNC/AWAIT Y DB) ---

const COOLDOWN_DAYS = 7;Â 

async function isQuizOnCooldown() {
Â  Â  const token = localStorage.getItem('token');
Â  Â Â 
Â  Â  // Si no hay token, el usuario no estÃ¡ logueado o estÃ¡ expirado.
Â  Â  if (!token) return false;Â 

Â  Â  try {
Â  Â  Â  Â  // **Â¡REVISA QUE API_URL ESTÃ‰ DEFINIDA CORRECTAMENTE!**
Â  Â  Â  Â  const res = await fetch(`${API_URL}/api/quiz/cooldown`, {
Â  Â  Â  Â  Â  Â  method: 'GET',
Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  'Authorization': `Bearer ${token}`Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  Â  console.error("Error al consultar cooldown:", res.status);
Â  Â  Â  Â  Â  Â  // Si el servidor falla (400, 500, etc.), asumimos que NO hay bloqueo.
Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  }

Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  const lastCompletionDateStr = data.last_completion_date;

Â  Â  Â  Â  if (!lastCompletionDateStr) {
Â  Â  Â  Â  Â  Â  return false; // No hay quizzes previos en la base de datos.
Â  Â  Â  Â  }

Â  Â  Â  Â  // Crear objeto Date a partir de la fecha de la base de datos (YYYY-MM-DD)
Â  Â  Â  Â  const lastDate = new Date(lastCompletionDateStr);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Calcular la fecha de expiraciÃ³n: Ãšltimo Quiz + 7 dÃ­as (en milisegundos)
Â  Â  Â  Â  const cooldownExpiry = new Date(lastDate.getTime() + COOLDOWN_DAYS * 24 * 60 * 60 * 1000);

Â  Â  Â  Â  // Devolvemos TRUE si la fecha de expiraciÃ³n es FUTURA.
Â  Â  Â  Â  return new Date() < cooldownExpiry;

Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Error de red o CORS al consultar cooldown:", error);
Â  Â  Â  Â  // Error de red (el API estÃ¡ caÃ­do o URL mal). Asumimos NO hay bloqueo para evitar carga infinita.
Â  Â  Â  Â  return false;Â 
Â  Â  }
}


function getPreviousResult() {
Â  Â  const result = localStorage.getItem(PREVIOUS_RESULT_KEY);
Â  Â  return result ? JSON.parse(result) : null;
}

// --- FUNCIONES DE NAVEGACIÃ“N Y RENDERIZADO ---
function renderQuestion(index) {
Â  Â  if (!questionsContainer) return;
Â  Â  // **CAMBIO 1: Eliminada la gestiÃ³n de 'loadingEl' de aquÃ­.**
Â  Â  // if (loadingEl) loadingEl.style.display = 'none'; <--- Â¡ESTO SE MUEVE AL DOMContentLoaded!
Â  Â Â 
Â  Â  questionsContainer.innerHTML = '';
Â  Â  const questionData = QUIZ_DATA[index];
Â  Â  const questionNumber = index + 1;
Â  Â  const scale = ANSWER_SCALES[questionData.scaleType || DEFAULT_SCALE];

Â  Â  questionsContainer.innerHTML = `
Â  Â  Â  Â  <div class="question-item">
Â  Â  Â  Â  Â  Â  <p class="question-text font-bold text-xl mb-6">(${questionNumber}/${QUIZ_DATA.length}) ${questionData.text}</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="options-group" id="optionsGroup">
Â  Â  Â  Â  Â  Â  ${scale.options.map((option, i) => `
Â  Â  Â  Â  Â  Â  Â  Â  <button class="option-btn ${userAnswers[index] === (i + 1) ? 'selected' : ''}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-value="${i + 1}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${option}
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  </div>
Â  Â  `;

Â  Â  document.getElementById('optionsGroup').addEventListener('click', handleOptionClick);
Â  Â  updateUIState();
}

function handleOptionClick(e) {
Â  Â  const target = e.target.closest('.option-btn');
Â  Â  if (!target) return;

Â  Â  Array.from(target.parentNode.children).forEach(btn => btn.classList.remove('selected'));
Â  Â  target.classList.add('selected');

Â  Â  const value = parseInt(target.dataset.value);
Â  Â  userAnswers[currentQuestionIndex] = value;
Â  Â Â 
Â  Â  localStorage.setItem('quiz_progress_answers', JSON.stringify(userAnswers));
Â  Â  localStorage.setItem('quiz_progress_index', currentQuestionIndex);

Â  Â  setTimeout(() => {
Â  Â  Â  Â  if (currentQuestionIndex < QUIZ_DATA.length - 1) {
Â  Â  Â  Â  Â  Â  currentQuestionIndex++;
Â  Â  Â  Â  Â  Â  renderQuestion(currentQuestionIndex);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  updateUIState();
Â  Â  Â  Â  }
Â  Â  }, 200);
}

function updateUIState() {
Â  Â  const answered = userAnswers.filter(a => a !== null && a !== undefined).length;
Â  Â  const pct = ((currentQuestionIndex + 1) / QUIZ_DATA.length) * 100;
Â  Â  if (progressBarFill) progressBarFill.style.width = `${pct}%`;
Â  Â  if (progressText) progressText.textContent = `PREGUNTA ${currentQuestionIndex + 1} DE ${QUIZ_DATA.length}`;

Â  Â  if (prevBtn) prevBtn.style.display = currentQuestionIndex > 0 ? 'block' : 'none';
Â  Â Â 
Â  Â  const isLast = currentQuestionIndex === QUIZ_DATA.length - 1;
Â  Â  const isAnswered = userAnswers[currentQuestionIndex] != null;

Â  Â  if (nextBtn) nextBtn.style.display = (!isLast) ? 'block' : 'none';
Â  Â  if (submitBtn) submitBtn.style.display = (isLast && isAnswered) ? 'block' : 'none';
}

// --- CÃLCULO Y RESULTADOS ---
// --- CÃLCULO Y RESULTADOS ---
function submitQuiz() {
Â  Â  if (userAnswers.filter(a => a).length < QUIZ_DATA.length) {
Â  Â  Â  Â  showAlertModal("Incompleto", "Por favor responde todas las preguntas.");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const skillScores = {};
Â  Â  const maxScores = {};
Â  Â  Object.keys(SKILL_FEEDBACK).forEach(k => { skillScores[k] = 0; maxScores[k] = 0; });

Â  Â  QUIZ_DATA.forEach((q, idx) => {
Â  Â  Â  Â  const val = userAnswers[idx];
Â  Â  Â  Â  q.scores.forEach(impact => {
Â  Â  Â  Â  Â  Â  let score = (impact.polarity === 1) ? (val - 1) : (MAX_SCORE_PER_QUESTION_RAW - val);
Â  Â  Â  Â  Â  Â  skillScores[impact.skill] += score;
Â  Â  Â  Â  Â  Â  maxScores[impact.skill] += 4;Â 
Â  Â  Â  Â  });
Â  Â  });

Â  Â  const results = [];
Â  Â  Object.keys(skillScores).forEach(skill => {
Â  Â  Â  Â  const max = maxScores[skill];
Â  Â  Â  Â  const pct = max > 0 ? Math.round((skillScores[skill] / max) * 100) : 0;
Â  Â  Â  Â  results.push({ name: skill, percentage: pct });
Â  Â  });
Â  Â Â 
Â  Â  results.sort((a, b) => b.percentage - a.percentage);
Â  Â Â 
Â  Â  let profile = PROFILES.find(p => p.name.includes("INTEGRAL"));
Â  Â  const top3Names = results.slice(0,3).map(r => r.name);
Â  Â Â 
Â  Â  for (const p of PROFILES) {
Â  Â  Â  Â  const matches = p.skills.filter(s => top3Names.includes(s)).length;
Â  Â  Â  Â  if (matches >= 2) { profile = p; break; }
Â  Â  }

Â  Â  quizResults = { skills: results, profile: profile, date: new Date().toISOString() };
Â  Â Â 
Â  Â  // CORRECCIÃ“N CLAVE: Estructura final con valores de respuesta como STRING y todas las claves necesarias
Â  Â  window.finalQuizResult = {
Â  Â  Â  Â  answers: userAnswers.reduce((acc, val, idx) => ({...acc, [`q${QUIZ_DATA[idx].id}`]: val.toString()}), {}),Â 
Â  Â  Â  Â  softSkills: results.map(r => ({ skill: r.name, score: r.percentage })),
Â  Â  Â  Â  profile: profile.name,
Â  Â  Â  Â  date: new Date().toISOString().split('T')[0],
Â  Â  Â  Â  profileDescription: profile.description
Â  Â  };

Â  Â  localStorage.setItem(LAST_QUIZ_KEY, new Date().toISOString());
Â  Â  localStorage.setItem(PREVIOUS_RESULT_KEY, JSON.stringify(quizResults));
Â  Â  localStorage.removeItem('quiz_progress_answers');
Â  Â  localStorage.removeItem('quiz_progress_index');

Â  Â  renderResultsView();
}

async function saveResultsToAPI() {
Â  Â  const token = localStorage.getItem('token');
Â  Â  if (!token) return showAlertModal("Error", "Debes iniciar sesiÃ³n.", true);
Â  Â Â 
Â  Â  saveResultBtn.disabled = true;
Â  Â  saveResultBtn.textContent = "Guardando...";
Â  Â Â 
Â  Â  try {
Â  Â  Â  Â  // CORRECCIÃ“N 2: Se asegura la barra inclinada final en la URL
Â  Â  Â  Â  const res = await fetch(`${API_URL}/api/quiz/`, {Â 
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',Â 
Â  Â  Â  Â  Â  Â  Â  Â  'Authorization': `Bearer ${token}` // Ahora es obligatorio para guardar el email del usuario
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  body: JSON.stringify(window.finalQuizResult)
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (res.status === 422) {
Â  Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  Â  let errorMessage = 'ğŸš¨ Error de ValidaciÃ³n de Datos (422):\n\n';
Â  Â  Â  Â  Â  Â  if (data.detail && Array.isArray(data.detail)) {
Â  Â  Â  Â  Â  Â  Â  Â  data.detail.forEach(err => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const field = err.loc[err.loc.length - 1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage += `â€¢ El campo "${field}" es invÃ¡lido: ${err.msg}\n`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  errorMessage += "Estructura de datos incorrecta. Revisa el archivo schemas.py.";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  throw new Error(errorMessage);
Â  Â  Â  Â  }

Â  Â  Â  Â  if (res.ok) {
Â  Â  Â  Â  Â  Â  showAlertModal("Guardado", "Resultados guardados correctamente en tu perfil.", false);
Â  Â  Â  Â  Â  Â  saveResultBtn.disabled = true;
Â  Â  Â  Â  Â  Â  saveResultBtn.textContent = "Guardado";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  throw new Error(`Error en el servidor: CÃ³digo ${res.status}`);
Â  Â  Â  Â  }
Â  Â  } catch (e) {
Â  Â  Â  Â  saveResultBtn.disabled = false;
Â  Â  Â  Â  saveResultBtn.textContent = "Guardar Resultado";
Â  Â  Â  Â  let displayMessage = e.message.includes('422') ? e.message : "No se pudo conectar con el servidor. (Error de red o servidor inactivo)";
Â  Â  Â  Â  showAlertModal("Error", displayMessage, true);
Â  Â  }
}
function renderResultsView() {
Â  Â  if (!quizEl || !resultEl) return;
Â  Â  quizEl.style.display = 'none';
Â  Â  resultEl.style.display = 'block';

Â  Â  const { profile, skills } = quizResults;
Â  Â Â 
Â  Â  if (profileNameEl) profileNameEl.textContent = profile.name;
Â  Â  if (profileDescriptionEl) profileDescriptionEl.textContent = profile.description;
Â  Â Â 
Â  Â  if (topSkillsPillsEl) {
Â  Â  Â  Â  topSkillsPillsEl.innerHTML = skills.slice(0, 3).map(s =>Â 
Â  Â  Â  Â  Â  Â  `<span class="bg-emerald-600 text-white text-xs px-3 py-1 rounded-full shadow border border-emerald-400">${s.name}</span>`
Â  Â  Â  Â  ).join('');
Â  Â  }

Â  Â  const prev = getPreviousResult();
Â  Â Â 
Â  Â  // GENERAR RESUMEN COMPARATIVO INTELIGENTE
Â  Â  let comparisonSummary = '';
Â  Â  if (prev) {
Â  Â  Â  Â  const improved = [];
Â  Â  Â  Â  const declined = [];
Â  Â  Â  Â  skills.forEach(s => {
Â  Â  Â  Â  Â  Â  const old = prev.skills.find(o => o.name === s.name);
Â  Â  Â  Â  Â  Â  if (old) {
Â  Â  Â  Â  Â  Â  Â  Â  if (s.percentage > old.percentage + 5) improved.push(s.name);
Â  Â  Â  Â  Â  Â  Â  Â  if (s.percentage < old.percentage - 5) declined.push(s.name);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  let narrative = "Comparando con tu Ãºltima sesiÃ³n: ";
Â  Â  Â  Â  if (improved.length > 0) narrative += `Has mostrado una evoluciÃ³n notable en <span class="text-emerald-400 font-bold">${improved.join(", ")}</span>. `;
Â  Â  Â  Â  if (declined.length > 0) narrative += `Sin embargo, se detecta un retroceso en <span class="text-red-400 font-bold">${declined.join(", ")}</span> que requiere atenciÃ³n. `;
Â  Â  Â  Â  if (improved.length === 0 && declined.length === 0) narrative += "Tus mÃ©tricas se mantienen estables. Es momento de romper la meseta con nuevos desafÃ­os.";
Â  Â  Â  Â Â 
Â  Â  Â  Â  comparisonSummary = `
Â  Â  Â  Â  Â  Â  <div class="p-5 bg-slate-800/80 border-l-4 border-blue-500 rounded shadow mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-blue-400 font-bold text-lg mb-2">ğŸ“Š Informe de Progreso Evolutivo</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-300 leading-relaxed text-justify">${narrative}</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  }

Â  Â  const listHTML = skills.map(s => {
Â  Â  Â  Â  const fb = SKILL_FEEDBACK[s.name];
Â  Â  Â  Â  const isHigh = s.percentage >= 75;
Â  Â  Â  Â  const detail = isHigh ? fb.high : fb.low;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let diffDisplay = '';
Â  Â  Â  Â  if (prev) {
Â  Â  Â  Â  Â  Â  const oldSkill = prev.skills.find(os => os.name === s.name);
Â  Â  Â  Â  Â  Â  if (oldSkill) {
Â  Â  Â  Â  Â  Â  Â  Â  const diff = s.percentage - oldSkill.percentage;
Â  Â  Â  Â  Â  Â  Â  Â  if (diff !== 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const color = diff > 0 ? 'text-emerald-400' : 'text-red-400';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const arrow = diff > 0 ? 'â¬†' : 'â¬‡';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  diffDisplay = `<span class="${color} text-sm font-bold ml-3 bg-slate-900 px-2 py-1 rounded border border-slate-700">${arrow} ${Math.abs(diff)}%</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  return `
Â  Â  Â  Â  <div class="mb-8 p-6 bg-slate-800 rounded-xl border border-slate-700 shadow-xl hover:border-slate-500 transition-colors">
Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-end mb-4 border-b border-slate-700 pb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-white mb-1">${s.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs uppercase tracking-wider font-semibold ${isHigh ? 'text-emerald-500' : 'text-orange-500'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${detail.title}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl font-black text-white">${s.percentage}%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${diffDisplay}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="grid md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-sm font-bold text-slate-400 mb-2 uppercase">DiagnÃ³stico & Impacto</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-300 leading-relaxed text-justify">${isHigh ? detail.strength : detail.weakness}</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-slate-700/30 p-4 rounded-lg border-l-2 ${isHigh ? 'border-emerald-500' : 'border-orange-500'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-sm font-bold ${isHigh ? 'text-emerald-400' : 'text-orange-400'} mb-2 uppercase">âš¡ Plan de AcciÃ³n TÃ¡ctico</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-300 italic leading-relaxed">${detail.tip}</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>`;
Â  Â  }).join('');

Â  Â  // Bloqueo de ReflexiÃ³n (Cooldown UI)
Â  Â  const cooldownBlock = `
Â  Â  Â  Â  <div class="mt-10 p-6 bg-indigo-900/40 border border-indigo-500/50 rounded-xl text-center">
Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-indigo-300 mb-2">ğŸ”’ Periodo de AsimilaciÃ³n Activo</h3>
Â  Â  Â  Â  Â  Â  <p class="text-sm text-indigo-100 mb-4">Para garantizar que este anÃ¡lisis se convierta en crecimiento real, el test se bloquearÃ¡ por <strong>${COOLDOWN_DAYS} dÃ­as</strong>. No consuma informaciÃ³n; ejecute el plan.</p>
Â  Â  Â  Â  Â  Â  <div class="inline-block bg-indigo-900 text-white text-xs px-3 py-1 rounded">PrÃ³xima evaluaciÃ³n disponible: ${new Date(Date.now() + COOLDOWN_DAYS * 86400000).toLocaleDateString()}</div>
Â  Â  Â  Â  </div>
Â  Â  `;

Â  Â  if (skillsList) skillsList.innerHTML = comparisonSummary + listHTML + cooldownBlock;
Â  Â Â 
Â  Â  if (saveResultBtn) saveResultBtn.disabled = false;
}

// ... (saveResultsToAPI, restartQuiz, etc. siguen aquÃ­)

// --- INIT (ACTUALIZADO para usar async/await y CORREGIDO el manejo del spinner) ---
// --- INIT (AJUSTADO) ---
document.addEventListener('DOMContentLoaded', async () => {
    // Bind DOM elements (IdÃ©ntico a tu original)
    quizEl = document.getElementById('quiz');
    resultEl = document.getElementById('result');
    questionsContainer = document.getElementById('questionsContainer');
    progressBarFill = document.getElementById('progressBarFill');
    progressText = document.getElementById('progressText');
    prevBtn = document.getElementById('prevBtn');
    nextBtn = document.getElementById('nextBtn');
    submitBtn = document.getElementById('submitBtn');
    alertModal = document.getElementById('alertModal');
    alertTitle = document.getElementById('alertTitle');
    alertMessage = document.getElementById('alertMessage');
    saveResultBtn = document.getElementById('saveResultBtn');
    backBtn = document.getElementById('backBtn');
    goHomeFromQuizBtn = document.getElementById('goHomeFromQuiz');
    loadingEl = document.getElementById('loading');
    topSkillsPillsEl = document.getElementById('topSkillsPills');
    skillsList = document.getElementById('skillsList');
    profileNameEl = document.getElementById('profileName');
    profileDescriptionEl = document.getElementById('profileDescription');
    restartQuizBtn = document.getElementById('restartQuizBtn');

    // Listeners (IdÃ©ntico a tu original)
    if(backBtn) backBtn.onclick = () => window.location.href = 'home.html';
    if(goHomeFromQuizBtn) goHomeFromQuizBtn.onclick = () => window.location.href = 'home.html';
    if(prevBtn) prevBtn.onclick = () => { if(currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(currentQuestionIndex); }};
    if(nextBtn) nextBtn.onclick = () => { 
        // ğŸŒŸ CORRECCIÃ“N MENOR: Verificar que haya respuesta antes de avanzar.
        if(userAnswers[currentQuestionIndex] != null) { 
            currentQuestionIndex++; 
            renderQuestion(currentQuestionIndex); 
        }
    };
    if(submitBtn) submitBtn.onclick = submitQuiz;
    if(saveResultBtn) saveResultBtn.onclick = saveResultsToAPI;
    if(restartQuizBtn) restartQuizBtn.onclick = restartQuiz;

    // ğŸŒŸ COOLDOWN CHECK ASÃNCRONO CONTRA LA BASE DE DATOS (IdÃ©ntico a tu original)
    const isOnCooldown = await isQuizOnCooldown();

    if (isOnCooldown) {
        const saved = getPreviousResult(); // Usamos el resultado de localStorage para la vista
        if (saved) {
            quizResults = saved;
            renderResultsView();
            showAlertModal("Modo ReflexiÃ³n", `EstÃ¡s en el periodo de asimilaciÃ³n de ${COOLDOWN_DAYS} dÃ­as. Se muestran tus Ãºltimos resultados.`, false);
        } else {
            // Manejo si estÃ¡ bloqueado pero no tiene resultados locales (IdÃ©ntico a tu original)
            quizEl.innerHTML = `<div class="text-center text-white p-10 bg-slate-800 rounded-xl">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">â³ Enfriamiento Activo</h3>
                <p class="mb-6">Has realizado el test recientemente. TÃ³mate un tiempo para aplicar lo aprendido.</p> 
                <button onclick="window.location.href='home.html'" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold">Volver al Inicio</button>
            </div>`;
        }
        
        // **CRÃTICO:** Ocultar el spinner al salir de la ruta de bloqueo. (IdÃ©ntico a tu original)
        if(loadingEl) loadingEl.style.display = 'none'; 
        return; // Detiene la carga del quiz.
    }

    // Load Progress & Start (solo se ejecuta si NO hay bloqueo) (IdÃ©ntico a tu original)
    const savedAns = localStorage.getItem('quiz_progress_answers');
    if (savedAns) userAnswers = JSON.parse(savedAns);
    const savedIdx = localStorage.getItem('quiz_progress_index');
    if (savedIdx) currentQuestionIndex = parseInt(savedIdx);

    // Shuffle si es nuevo (no hay respuestas guardadas) (IdÃ©ntico a tu original)
    if (!savedAns) shuffleArray(QUIZ_DATA);
    
    // **CRÃTICO:** Ocultar el spinner antes de renderizar la primera pregunta. (IdÃ©ntico a tu original)
    if(loadingEl) loadingEl.style.display = 'none';
    
    renderQuestion(currentQuestionIndex);
});
    </script>
  </body>
</html>



















