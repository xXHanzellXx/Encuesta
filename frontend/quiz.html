<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SoftSkills360 - Test de Habilidades</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-primary: #10b981;
      --color-accent: #3b82f6;
      --color-bg-dark: #0f172a;
      --color-card-dark: #1e293b;
      --color-text-light: #f1f5f9;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--color-bg-dark);
      background-image: radial-gradient(at 0% 0%, #1e3a8a 0%, transparent 50%),
                        radial-gradient(at 100% 100%, #10b981 0%, transparent 50%);
      min-height: 100vh;
      color: var(--color-text-light);
    }
    .navbar { @apply bg-slate-900 shadow-2xl p-4 flex justify-between items-center sticky top-0 z-10 border-b-4 border-emerald-600/50; }
    .navbar h1 { @apply text-3xl font-black text-white tracking-widest; }
    .quiz-container { @apply max-w-4xl mx-auto py-12 px-4; }
    .quiz-card, .result-card {
      background-color: var(--color-card-dark);
      @apply p-6 md:p-12 rounded-xl border border-gray-700/50;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.3),
                  0 10px 15px -3px rgba(0, 0, 0, 0.8),
                  0 4px 6px -4px rgba(0, 0, 0, 0.7);
    }
    .progress-bar { @apply w-full bg-slate-700/50 rounded-full h-2.5 mb-6; }
    .progress-fill {
      background-color: var(--color-primary);
      @apply h-2.5 rounded-full transition-all duration-700 ease-in-out;
      box-shadow: 0 0 8px var(--color-primary);
    }
    .question-item p {
      @apply text-3xl md:text-4xl font-extrabold text-white mb-10 leading-snug p-4 text-center;
      text-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
    }
    .option-btn {
      background-color: #374151;
      @apply flex-grow text-gray-100 border-2 border-slate-600 hover:bg-slate-600 transition-all duration-200 ease-in-out py-5 px-6 text-lg font-bold rounded-xl cursor-pointer min-w-[140px] max-w-[240px] sm:max-w-none transform hover:scale-[1.03] hover:shadow-lg;
      box-shadow: 0 4px 0 0 #1f2937;
    }
    .option-btn.selected {
      background-color: var(--color-primary);
      @apply border-white text-gray-900 font-extrabold transform scale-105;
      box-shadow: 0 0 15px var(--color-primary),
                  0 0 5px var(--color-primary),
                  0 4px 0 0 #0c4a31;
    }
    .cta-btn {
      background-color: var(--color-primary);
      @apply hover:bg-emerald-600 text-gray-900 font-extrabold py-3.5 px-8 rounded-xl shadow-xl transition duration-300 ease-in-out transform hover:scale-[1.02];
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);
    }
  </style>
</head>
<body>
  <header class="navbar">
    <h1>SoftSkills360</h1>
    <button id="backBtn" class="secondary-btn p-2 px-4">Volver</button>
  </header>

  <main class="quiz-container">
    <form id="quizForm" class="quiz-card">
      <h2 class="text-4xl font-extrabold text-center mb-8 text-white">TEST :: ESCANEO DE HABILIDADES</h2>
      <div class="progress-bar"><div id="progressBarFill" class="progress-fill" style="width:0%;"></div></div>
      <div id="questionsContainer" class="space-y-8">
        <p class="text-gray-400 text-center text-lg">Cargando preguntas...</p>
      </div>
      <div class="mt-10 text-center">
        <button type="submit" class="cta-btn">Finalizar Test</button>
      </div>
    </form>

    <div id="result" class="result-card" style="display:none;"></div>
  </main>

  <script>
  /****************************************************
   * SOFTSKILLS INTELLIGENCE ENGINE
   * Autor: El Tata y su compa GPT-5
   ****************************************************/
  const API_URL = "https://TU_API_RENDER_URL";
  const token = localStorage.getItem("token");
  if (!token) window.location.href = "index.html";

  document.getElementById("backBtn").onclick = () => window.location.href = "home.html";
  const form = document.getElementById("quizForm");
  const resultDiv = document.getElementById("result");

  const questionMap = {
    q1: ["Comunicaci√≥n"],
    q2: ["Empat√≠a"],
    q3: ["Resoluci√≥n de conflictos", "Liderazgo"],
    q4: ["Responsabilidad", "Organizaci√≥n"],
    q5: ["Adaptabilidad"],
    q6: ["Liderazgo"],
    q7: ["Paciencia", "Trabajo en equipo"],
    q8: ["Comunicaci√≥n"],
    q9: ["Creatividad", "Innovaci√≥n"],
    q10: ["Gesti√≥n emocional", "Resiliencia"],
    q11: ["Escucha activa", "Empat√≠a"],
    q12: ["Pensamiento cr√≠tico"],
    q13: ["Colaboraci√≥n", "Trabajo en equipo"],
    q14: ["Planificaci√≥n", "Orientaci√≥n a resultados"],
    q15: ["Motivaci√≥n", "Perseverancia"],
    q16: ["Gesti√≥n del tiempo", "Planificaci√≥n"],
    q17: ["Pensamiento cr√≠tico", "Toma de decisiones"],
    q18: ["Autoconocimiento", "Resiliencia"],
    q19: ["Trabajo en equipo", "Comunicaci√≥n"],
    q20: ["Creatividad", "Adaptabilidad"],
  };

  const answerValue = {
    "Muy en desacuerdo": 1,
    "En desacuerdo": 2,
    "Neutral": 3,
    "De acuerdo": 4,
    "Totalmente de acuerdo": 5,
  };

  const descriptions = {
    Comunicaci√≥n: "Capacidad para expresar ideas con claridad y escuchar activamente.",
    Empat√≠a: "Habilidad para comprender las emociones y perspectivas de los dem√°s.",
    Liderazgo: "Capacidad de guiar, inspirar y coordinar equipos hacia objetivos comunes.",
    Adaptabilidad: "Facilidad para ajustarse a cambios y mantener el rendimiento.",
    Creatividad: "Generar ideas innovadoras y soluciones originales ante problemas.",
    Resiliencia: "Resistir y recuperarse ante la adversidad con actitud positiva.",
    PensamientoCr√≠tico: "Analizar, evaluar y tomar decisiones con criterio propio.",
    TrabajoEnEquipo: "Colaborar y cooperar efectivamente en entornos grupales.",
    Planificaci√≥n: "Definir objetivos claros y trazar estrategias para alcanzarlos.",
    Gesti√≥nEmocional: "Regular emociones y mantener la calma en situaciones complejas.",
  };

  // Generar din√°micamente preguntas
  const questionsContainer = document.getElementById("questionsContainer");
  questionsContainer.innerHTML = "";
  Object.keys(questionMap).forEach((q, i) => {
    const div = document.createElement("div");
    div.classList.add("question-item");
    div.innerHTML = `
      <p>${i + 1}. ${Object.values(questionMap)[i][0]}</p>
      <div class="options-group flex flex-wrap justify-center gap-4 mt-4">
        ${Object.keys(answerValue)
          .map(
            (opt) => `
            <label class="option-btn">
              <input type="radio" name="${q}" value="${opt}" class="hidden">
              ${opt}
            </label>`
          )
          .join("")}
      </div>`;
    questionsContainer.appendChild(div);
  });

  // Env√≠o del formulario
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const answers = {};
    const scores = {};

    Object.values(questionMap).flat().forEach((s) => (scores[s] = 0));

    for (let i = 1; i <= 20; i++) {
      const field = `q${i}`;
      const answer = form[field].value;
      if (!answer) return alert("Por favor responde todas las preguntas");
      answers[field] = answer;
      const value = answerValue[answer] || 0;
      const skills = questionMap[field];
      skills.forEach((s) => (scores[s] += value));
    }

    const normalized = Object.entries(scores).map(([skill, total]) => {
      const relatedCount = Object.values(questionMap).filter((arr) => arr.includes(skill)).length;
      const score = (total / (relatedCount * 5)) * 100;
      return { skill, score: Math.round(score) };
    });

    const sorted = normalized.sort((a, b) => b.score - a.score);
    const top5 = sorted.slice(0, 5);
    const low2 = sorted.slice(-2);
    const personality = getProfile(sorted);
    const recommendations = generateRecommendations(top5, low2);
    displayResults(top5, low2, personality, recommendations);

    await fetch(`${API_URL}/api/quiz`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({
        answers,
        softSkills: top5.map((s) => s.skill),
        profile: personality.title,
      }),
    });
  });

  function getProfile(sorted) {
    const highest = sorted[0].skill;
    const profiles = {
      Liderazgo: ["El Estratega Visionario üß≠", "Gu√≠as e inspiras a otros hacia metas comunes."],
      Comunicaci√≥n: ["El Comunicador Nato üé§", "Expresas y conectas con claridad y empat√≠a."],
      Empat√≠a: ["El Conector Emocional üíû", "Comprendes las emociones y motivaciones ajenas."],
      Creatividad: ["El Innovador üåà", "Generas ideas √∫nicas y soluciones originales."],
      Planificaci√≥n: ["El Estratega Organizado üìÖ", "Eres met√≥dico y enfocado en resultados."],
      Resiliencia: ["El Guerrero Sereno ‚öîÔ∏è", "Enfrentas desaf√≠os con calma y perseverancia."],
    };
    return profiles[highest] ? { title: profiles[highest][0], description: profiles[highest][1] } : 
      { title: "El Colaborador Integral üí™", description: "Equilibrio entre diversas habilidades." };
  }

  function generateRecommendations(top, low) {
    const recs = [];
    top.forEach((s) => recs.push(`‚úÖ Fortalece tu ${s.skill}: ${descriptions[s.skill] || ""}`));
    low.forEach((s) =>
      recs.push(`‚ö° Mejora en ${s.skill}: ${descriptions[s.skill] || ""}`)
    );
    recs.push("üßò‚Äç‚ôÇÔ∏è Mant√©n un balance emocional y mental constante.");
    return recs;
  }

  function displayResults(top, low, profile, recs) {
    form.style.display = "none";
    resultDiv.style.display = "block";
    resultDiv.innerHTML = `
      <h2 class="text-3xl font-extrabold text-center mb-4 text-emerald-400">${profile.title}</h2>
      <p class="text-center mb-6">${profile.description}</p>
      <h4 class="text-xl font-bold mb-2">üèÜ Fortalezas</h4>
      <ul class="list-disc pl-6 mb-4">${top.map((s) => `<li>${s.skill}: ${s.score}%</li>`).join("")}</ul>
      <h4 class="text-xl font-bold mb-2">‚ö†Ô∏è √Åreas a mejorar</h4>
      <ul class="list-disc pl-6 mb-4">${low.map((s) => `<li>${s.skill}: ${s.score}%</li>`).join("")}</ul>
      <h4 class="text-xl font-bold mb-2">üß≠ Recomendaciones</h4>
      <ul class="list-disc pl-6 mb-4">${recs.map((r) => `<li>${r}</li>`).join("")}</ul>
      <div class="text-center mt-6">
        <button class="cta-btn" onclick="window.location.href='home.html'">Volver al inicio</button>
      </div>`;
  }
  </script>
</body>
</html>
